function ignore(){}function id(n){return n}function fst(n){return n[0]}function snd(n){return n[1]}function trd(n){return n[2]}IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i in n)t[i]=n[i];return t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};IntelliFactory.Runtime.OnLoad(function(){window.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});console||(console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore});
(function(){for(var i=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();
(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1;a=window;b=a.SPA1=a.SPA1||{};c=b.Client=b.Client||{};d=a.WebSharper=a.WebSharper||{};e=d.UI=d.UI||{};f=e.An=e.An||{};g=c.EndPoint=c.EndPoint||{};h=a.SPA1_Router=a.SPA1_Router||{};i=a.SPA1_Templates=a.SPA1_Templates||{};j=e.Router=e.Router||{};k=d.Operators=d.Operators||{};l=d.Unchecked=d.Unchecked||{};m=a.System=a.System||{};n=m.Guid=m.Guid||{};o=d.Obj=d.Obj||{};p=d.List=d.List||{};q=p.T=p.T||{};r=e.Var=e.Var||{};s=c.Model=c.Model||{};t=c.TODO=c.TODO||{};u=e.View=e.View||{};v=d.Arrays=d.Arrays||{};w=e.AttrModule=e.AttrModule||{};x=e.AttrProxy=e.AttrProxy||{};y=e.Templating=e.Templating||{};z=y.Runtime=y.Runtime||{};A=z.Server=z.Server||{};B=A.Handler=A.Handler||{};C=A.TemplateInstance=A.TemplateInstance||{};D=a.Event;E=a.UIEvent;F=c.Message=c.Message||{};G=e.Anims=e.Anims||{};H=d.Sitelets=d.Sitelets||{};I=H.RouterOperators=H.RouterOperators||{};J=H.Route=H.Route||{};K=H.RouterModule=H.RouterModule||{};L=a.EventTarget;M=d.Utils=d.Utils||{};N=a.Node;O=e.Abbrev=e.Abbrev||{};P=O.Fresh=O.Fresh||{};Q=a.StartupCode$SPA1$Client=a.StartupCode$SPA1$Client||{};R=d.Numeric=d.Numeric||{};S=e.Doc=e.Doc||{};T=d.JavaScript=d.JavaScript||{};U=T.Pervasives=T.Pervasives||{};V=e.Snap=e.Snap||{};W=e.Attrs=e.Attrs||{};X=e.DomUtility=e.DomUtility||{};Y=e.Array=e.Array||{};Z=d.Collections=d.Collections||{};_0=Z.Dictionary=Z.Dictionary||{};_1=Z.HashSet=Z.HashSet||{};_2=z.Client=z.Client||{};_3=d.Seq=d.Seq||{};_4=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};_5=T.JSModule=T.JSModule||{};_6=H.Router=H.Router||{};_7=H.List=H.List||{};_8=e.ConcreteVar=e.ConcreteVar||{};_9=d.Strings=d.Strings||{};_=e.Docs=e.Docs||{};$=e.DynamicAttrNode=e.DynamicAttrNode||{};ba=a.Object;bb=Z.DictionaryUtil=Z.DictionaryUtil||{};bc=d.Enumerator=d.Enumerator||{};bd=bc.T=bc.T||{};be=e.Easing=e.Easing||{};bf=Z.FSharpMap=Z.FSharpMap||{};bg=Z.Map=Z.Map||{};bh=d.Lazy=d.Lazy||{};bi=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};bj=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};bk=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};bl=O.Mailbox=O.Mailbox||{};bm=Z.BalancedTree=Z.BalancedTree||{};bn=bm.Tree=bm.Tree||{};bo=Z.Pair=Z.Pair||{};bp=d.LazyExtensionsProxy=d.LazyExtensionsProxy||{};bq=bp.LazyRecord=bp.LazyRecord||{};br=H.PathUtil=H.PathUtil||{};bs=e.List=e.List||{};bt=e.DocElemNode=e.DocElemNode||{};bu=a.CharacterData;bv=a.StartupCode$WebSharper_UI$Doc_Client=a.StartupCode$WebSharper_UI$Doc_Client||{};bw=e.CheckedInput=e.CheckedInput||{};bx=d.Slice=d.Slice||{};by=e.Elt=e.Elt||{};bz=e.Client=e.Client||{};bA=bz.Docs=bz.Docs||{};bB=bA.RunState=bA.RunState||{};bC=bA.NodeSet=bA.NodeSet||{};bD=Z.HashSetUtil=Z.HashSetUtil||{};bE=Z.MapUtil=Z.MapUtil||{};bF=bz.Attrs=bz.Attrs||{};bG=bF.Dyn=bF.Dyn||{};bH=d.Queue=d.Queue||{};bI=e.String=e.String||{};bJ=e.Updates=e.Updates||{};bK=d.Concurrency=d.Concurrency||{};bL=e.AppendList=e.AppendList||{};bM=d.Char=d.Char||{};bN=bK.AsyncBody=bK.AsyncBody||{};bO=a.StartupCode$WebSharper_Main$Concurrency=a.StartupCode$WebSharper_Main$Concurrency||{};bP=bK.CT=bK.CT||{};bQ=O.HashSet=O.HashSet||{};bR=bK.Scheduler=bK.Scheduler||{};bS=d.CancellationTokenSource=d.CancellationTokenSource||{};bT=d.OperationCanceledException=d.OperationCanceledException||{};bU=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};bV=bA.DomNodes=bA.DomNodes||{};bW=a.console;bX=a.Math;bY=a.IntelliFactory;bZ=bY&&bY.Runtime;b0=a.jQuery;b1=a.Date;c.Main=function(){var b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce;function cf(cj){c.update(c.model(),F.ClearCompleted);}function cg(cj){c.update(c.model(),{$:3,$0:!cj.Vars.Hole("isselected").Get()});}function ch(cj){if(cj.Event.key==="Enter"){c.update(c.model(),{$:0,$0:cj.Vars.Hole("task").Get()});cj.Vars.Hole("task").Set("");}}function ci(cj){var ck,cl;for(ck=1,cl=1000;ck<=cl;ck++)c.update(c.model(),{$:0,$0:(function(cm){return function(cn){return cm("Do task #"+a.String(cn));};}(a.id))(ck)});c.update(c.model(),{$:3,$0:true});}f.set_UseAnimations(false);b2=j.InstallHash(g.All,h.r());S.RunById("main",(b3=(b4=(b5=(b6=(b7=(b8=(b9=(b_=[null],[b_,(b$=n.NewGuid(),a.String(b$)),new q({$:1,$0:{$:5,$0:"clearcompleted",$1:true,$2:function(cj){return function(ck){return cf({Vars:b_[0],Target:cj,Event:ck});};}},$1:new q({$:1,$0:{$:0,$0:"todos",$1:S.ConvertSeqVarBy(function(cj){return cj.Id;},function(cj){var ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw;function cx(cA){c.update(c.model(),{$:1,$0:cj});}function cy(cA){cA.Vars.Hole("task").Set(cj.Get().Task);c.update(c.model(),{$:4,$0:cj});}function cz(cA){cA.Event.key==="Enter"?c.update(c.model(),{$:5,$0:cj,$1:cA.Vars.Hole("task").Get()}):void 0;cA.Event.key==="Escape"||cA.Event.key==="Enter"?r.Lens(cj,function(cB){return cB.IsEdited;},function(cB,cC){return t.New(cB.Id,cB.Task,cB.IsCompleted,cC);}).Set(false):void 0;cA.Event.preventDefault();}return(ck=(cl=(cm=(cn=(co=(cp=(cq=n.NewGuid(),a.String(cq)),(cr=new q({$:1,$0:{$:0,$0:"label",$1:S.TextView(u.Map(function(cA){return cA.Task;},cj.get_View()))},$1:q.Empty}),[[null],cp,new q({$:1,$0:{$:3,$0:"cssattrs",$1:x.Concat(p.ofArray([w.DynamicClassPred("completed",u.Map(function(cA){return cA.IsCompleted;},cj.get_View())),w.DynamicClassPred("editing",u.Map(function(cA){return cA.IsEdited;},cj.get_View())),w.DynamicClassPred("hidden",u.Map2(function(cA,cB){return cA.$==2?!cB.IsCompleted:cA.$==1&&cB.IsCompleted;},b2.get_View(),cj.get_View()))]))},$1:cr})])),[co[0],co[1],new q({$:1,$0:{$:8,$0:"ischecked",$1:r.Lens(cj,function(cA){return cA.IsCompleted;},function(cA,cB){return t.New(cA.Id,cA.Task,cB,cA.IsEdited);})},$1:co[2]})]),[cn[0],cn[1],new q({$:1,$0:(cs=cn[0],{$:5,$0:"remove",$1:true,$2:function(cA){return function(cB){return cx({Vars:cs[0],Target:cA,Event:cB});};}}),$1:cn[2]})]),[cm[0],cm[1],new q({$:1,$0:(ct=cm[0],{$:5,$0:"toggleedit",$1:true,$2:function(cA){return function(cB){return cy({Vars:ct[0],Target:cA,Event:cB});};}}),$1:cm[2]})]),[cl[0],cl[1],new q({$:1,$0:(cu=cl[0],{$:5,$0:"edit",$1:true,$2:function(cA){return function(cB){return cz({Vars:cu[0],Target:cA,Event:cB});};}}),$1:cl[2]})]),(cv=ck[0],(cw=B.CompleteHoles(ck[1],ck[2],[["ischecked",2],["task",0]]),(cv[0]=new C.New(cw[1],i.todo(cw[0])),cv[0])))).get_Doc();},r.Lens(c.model(),function(cj){return cj.TODOs;},function(cj,ck){return s.New(cj.Counter,ck);}))},$1:q.Empty})})]),[b9[0],b9[1],new q({$:1,$0:(ca=b9[0],{$:5,$0:"selectall",$1:true,$2:function(cj){return function(ck){return cg({Vars:ca[0],Target:cj,Event:ck});};}}),$1:b9[2]})]),[b8[0],b8[1],new q({$:1,$0:(cb=b8[0],{$:5,$0:"edit",$1:true,$2:function(cj){return function(ck){return ch({Vars:cb[0],Target:cj,Event:ck});};}}),$1:b8[2]})]),[b7[0],b7[1],new q({$:1,$0:{$:3,$0:"cssfilterall",$1:w.DynamicClassPred("selected",u.Map(function(cj){return cj.$===0;},b2.get_View()))},$1:b7[2]})]),[b6[0],b6[1],new q({$:1,$0:{$:3,$0:"cssfilteractive",$1:w.DynamicClassPred("selected",u.Map(function(cj){return cj.$===1;},b2.get_View()))},$1:b6[2]})]),[b5[0],b5[1],new q({$:1,$0:{$:3,$0:"cssfiltercompleted",$1:w.DynamicClassPred("selected",u.Map(function(cj){return cj.$===2;},b2.get_View()))},$1:b5[2]})]),[b4[0],b4[1],new q({$:1,$0:(cc=b4[0],{$:5,$0:"runbenchmark",$1:true,$2:function(cj){return function(ck){return ci({Vars:cc[0],Target:cj,Event:ck});};}}),$1:b4[2]})]),(cd=b3[0],(ce=B.CompleteHoles(b3[1],b3[2],[["task",0],["isselected",2]]),(cd[0]=new C.New(ce[1],i.main(ce[0])),cd[0])))).get_Doc());};c.model=function(){Q.$cctor();return Q.model;};c.update=function(b2,b3){var b4;if(b3.$==1)b2.Set(b2.Get().RemoveTodo(b3.$0.Get().Id));else if(b3.$==2)b2.Set(b2.Get().RemoveCompleted());else if(b3.$==3)b2.Set(b2.Get().UpdateAllTo(b3.$0));else if(b3.$==4){b4=r.Lens(b3.$0,function(b5){return b5.IsEdited;},function(b5,b6){return t.New(b5.Id,b5.Task,b5.IsCompleted,b6);});b4.Set(!b4.Get());}else if(b3.$==5)r.Lens(b3.$0,function(b5){return b5.Task;},function(b5,b6){return t.New(b5.Id,b6,b5.IsCompleted,b5.IsEdited);}).Set(b3.$1);else b2.Set(b2.Get().AddTodo(b3.$0));};f.set_UseAnimations=function(b2){G.set_UseAnimations(b2);};f.get_UseAnimations=function(){return G.UseAnimations();};f.Play=function(b2){var b3;b3=null;return bK.Delay(function(){return bK.Bind(f.Run(a.ignore,G.Actions(b2)),function(){G.Finalize(b2);return bK.Return(null);});});};f.Append=function(b2,b3){return{$:0,$0:bL.Append(b2.$0,b3.$0)};};f.Concat=function(b2){return{$:0,$0:bL.Concat(_3.map(G.List,b2))};};f.Run=function(b2,b3){var b4;function b5(b6){function b7(b8,b9){var b_;b_=b9-b8;b3.Compute(b_);b2();return b_<=b4?void a.requestAnimationFrame(function(b$){b7(b8,b$);}):b6();}a.requestAnimationFrame(function(b8){b7(b8,b8);});}b4=b3.Duration;return b4===0?bK.Zero():bK.FromContinuations(function(b6,b7,b8){return b5.apply(null,[b6,b7,b8]);});};f.get_Empty=function(){return{$:0,$0:bL.Empty()};};g.All={$:0};h.r=function(){return I.JSUnion(void 0,[[null,[[null,[]]],[]],[null,[[null,["active"]]],[]],[null,[[null,["completed"]]],[]]]);};i.todo=function(b2){S.LoadLocalTemplates("index");return b2?S.NamedTemplate("index",{$:1,$0:"todo"},b2):void 0;};i.main=function(b2){S.LoadLocalTemplates("index");return b2?S.NamedTemplate("index",{$:1,$0:"main"},b2):void 0;};j.InstallHash=function(b2,b3){var b4;function b5(b8){return K.Parse(b3,J.FromHash(b8,{$:1,$0:true}));}function b6(){var b8,b9;b8=a.location.hash;b9=b5(b8);return b9==null?((function(b_){return function(b$){return b_("Failed to parse route: "+M.toSafe(b$));};}(function(b_){bW.log(b_);}))(b8),b2):b9.$0;}function b7(b8){if(!l.Equals(b4.Get(),b8))b4.Set(b8);}b4=r.Create$1(b6());a.onpopstate=function(){return b7(b6());};a.onhashchange=function(){return b7(b6());};a.jQuery(a.document.body).click(function(b8){var b9,b_,b$,ca;b9=a.jQuery(b8.target).closest("a").toArray();return!l.Equals(b9,null)&&b9.length===1?(b_=v.get(b9,0),b_.localName==="a"?(b$=b_.getAttribute("href"),!(b$==null)&&_9.StartsWith(b$,"#")?(ca=b5(b$),ca==null?null:(b7(ca.$0),b8.preventDefault())):null):null):null;});u.Sink(function(b8){var b9;if(!l.Equals(b8,b6())){b9=K.HashLink(b3,b8);a.history.pushState(null,null,b9);}},b4.get_View());return b4;};k.FailWith=function(b2){throw a.Error(b2);};k.KeyValue=function(b2){return[b2.K,b2.V];};l.Equals=function(b2,b3){var b4,b5,b6,b7;if(b2===b3)return true;else{b4=typeof b2;if(b4=="object"){if(b2===null||b2===void 0||b3===null||b3===void 0)return false;else if("Equals"in b2)return b2.Equals(b3);else if(b2 instanceof a.Array&&b3 instanceof a.Array)return l.arrayEquals(b2,b3);else if(b2 instanceof a.Date&&b3 instanceof a.Date)return l.dateEquals(b2,b3);else{b5=[true];for(var b8 in b2)if(function(b9){b5[0]=!b2.hasOwnProperty(b9)||b3.hasOwnProperty(b9)&&l.Equals(b2[b9],b3[b9]);return!b5[0];}(b8))break;if(b5[0]){for(var b9 in b3)if(function(b_){b5[0]=!b3.hasOwnProperty(b_)||b2.hasOwnProperty(b_);return!b5[0];}(b9))break;}return b5[0];}}else return b4=="function"&&("$Func"in b2?b2.$Func===b3.$Func&&b2.$Target===b3.$Target:"$Invokes"in b2&&"$Invokes"in b3&&l.arrayEquals(b2.$Invokes,b3.$Invokes));}};l.arrayEquals=function(b2,b3){var b4,b5;if(v.length(b2)===v.length(b3)){b4=true;b5=0;while(b4&&b5<v.length(b2)){!l.Equals(v.get(b2,b5),v.get(b3,b5))?b4=false:void 0;b5=b5+1;}return b4;}else return false;};l.dateEquals=function(b2,b3){return b2.getTime()===b3.getTime();};l.Hash=function(b2){var b3;b3=typeof b2;return b3=="function"?0:b3=="boolean"?b2?1:0:b3=="number"?b2:b3=="string"?l.hashString(b2):b3=="object"?b2==null?0:b2 instanceof a.Array?l.hashArray(b2):l.hashObject(b2):0;};l.hashString=function(b2){var b3,b4,b5;if(b2===null)return 0;else{b3=5381;for(b4=0,b5=b2.length-1;b4<=b5;b4++)b3=l.hashMix(b3,b2[b4].charCodeAt());return b3;}};l.hashArray=function(b2){var b3,b4,b5;b3=-34948909;for(b4=0,b5=v.length(b2)-1;b4<=b5;b4++)b3=l.hashMix(b3,l.Hash(v.get(b2,b4)));return b3;};l.hashObject=function(b2){var b3,b4;if("GetHashCode"in b2)return b2.GetHashCode();else{b3=[0];for(var b5 in b2)if(function(b6){b3[0]=l.hashMix(l.hashMix(b3[0],l.hashString(b6)),l.Hash(b2[b6]));return false;}(b5))break;return b3[0];}};l.hashMix=function(b2,b3){return(b2<<5)+b2+b3;};l.Compare=function(b2,b3){var b4,b5,b6,b7,b8,b9;if(b2===b3)return 0;else{b5=typeof b2;switch(b5=="function"?1:b5=="boolean"?2:b5=="number"?2:b5=="string"?2:b5=="object"?3:0){case 0:return typeof b3=="undefined"?0:-1;break;case 1:return k.FailWith("Cannot compare function values.");break;case 2:return b2<b3?-1:1;break;case 3:if(b2===null)b6=-1;else if(b3===null)b6=1;else if("CompareTo"in b2)b6=b2.CompareTo(b3);else if("CompareTo0"in b2)b6=b2.CompareTo0(b3);else if(b2 instanceof a.Array&&b3 instanceof a.Array)b6=l.compareArrays(b2,b3);else if(b2 instanceof a.Date&&b3 instanceof a.Date)b6=l.compareDates(b2,b3);else{b7=[0];for(var b_ in b2)if(function(b$){return!b2.hasOwnProperty(b$)?false:!b3.hasOwnProperty(b$)?(b7[0]=1,true):(b7[0]=l.Compare(b2[b$],b3[b$]),b7[0]!==0);}(b_))break;if(b7[0]===0){for(var b$ in b3)if(function(ca){return!b3.hasOwnProperty(ca)?false:!b2.hasOwnProperty(ca)&&(b7[0]=-1,true);}(b$))break;}b6=b7[0];}return b6;break;}}};l.compareArrays=function(b2,b3){var b4,b5;if(v.length(b2)<v.length(b3))return -1;else if(v.length(b2)>v.length(b3))return 1;else{b4=0;b5=0;while(b4===0&&b5<v.length(b2)){b4=l.Compare(v.get(b2,b5),v.get(b3,b5));b5=b5+1;}return b4;}};l.compareDates=function(b2,b3){return l.Compare(b2.getTime(),b3.getTime());};n.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(new a.RegExp("[xy]","g"),function(b2){var b3,b4;b3=bX.random()*16|0;b4=b2=="x"?b3:b3&3|8;return b4.toString(16);});};o=d.Obj=bZ.Class({Equals:function(b2){return this===b2;},GetHashCode:function(){return -1;}},null,o);q=p.T=bZ.Class({GetEnumerator:function(){return new bd.New(this,null,function(b2){var b3;b3=b2.s;return b3.$==0?false:(b2.c=b3.$0,b2.s=b3.$1,true);},void 0);},GetEnumerator0:function(){return bc.Get(this);}},null,q);q.Empty=new q({$:0});r.Lens=function(b2,b3,b4){var b5,b6,b7;b5=P.Id();b6=u.Map(b3,b2.get_View());b7=new r({Get:function(){return b3(b2.Get());},Set:function(b8){return b2.Update(function(b9){return b4(b9,b8);});},SetFinal:function(b8){return this.Set(b8);},Update:function(b8){return b2.Update(function(b9){return b4(b9,b8(b3(b9)));});},UpdateMaybe:function(b8){return b2.UpdateMaybe(function(b9){var b_;b_=b8(b3(b9));return b_==null?null:{$:1,$0:b4(b9,b_.$0)};});},get_View:function(){return b6;},get_Id:function(){return b5;}});r.New.call(b7);return b7;};r.Create$1=function(b2){return new _8.New(false,V.New({$:2,$0:b2,$1:[]}),b2);};r.MapLens=function(b2,b3,b4){return u.MapSeqCachedViewBy(b2,function(b5,b6){var b7,b8;function b9(b_){return l.Equals(b2(b_),b5);}b7=P.Id();return b3((b8=new r({Get:function(){return _3.find(b9,b4.Get());},Set:function(b_){function b$(ca){return b_;}return b4.Update(function(ca){return bs.replaceFirst(b9,b$,ca);});},SetFinal:function(b_){return this.Set(b_);},Update:function(b_){return b4.Update(function(b$){return bs.replaceFirst(b9,b_,b$);});},UpdateMaybe:function(b_){return b4.Update(function(b$){return bs.maybeReplaceFirst(b9,b_,b$);});},get_View:function(){return b6;},get_Id:function(){return b7;}}),(r.New.call(b8),b8)));},b4.get_View());};r.Set=function(b2,b3){b2.Set(b3);};s=c.Model=bZ.Class({RemoveTodo:function(b2){return s.New(this.Counter,p.filter(function(b3){return b3.Id!==b2;},this.TODOs));},RemoveCompleted:function(){return s.New(this.Counter,p.filter(function(b2){return!b2.IsCompleted;},this.TODOs));},UpdateAllTo:function(b2){return s.New(this.Counter,p.map(function(b3){return b3.UpdateCompleted(b2);},this.TODOs));},AddTodo:function(b2){var b3;b3=this.Counter+1;return s.New(b3,p.append(this.TODOs,p.ofArray([t.New(b3,b2,false,false)])));}},null,s);s.get_Empty=function(){return s.New(0,q.Empty);};s.New=function(b2,b3){return new s({Counter:b2,TODOs:b3});};t=c.TODO=bZ.Class({UpdateCompleted:function(b2){return t.New(this.Id,this.Task,b2,this.IsEdited);}},null,t);t.New=function(b2,b3,b4,b5){return new t({Id:b2,Task:b3,IsCompleted:b4,IsEdited:b5});};u.Map=function(b2,b3){return u.CreateLazy(function(){return V.Map(b2,b3());});};u.Map2=function(b2,b3,b4){return u.CreateLazy(function(){return V.Map2(b2,b3(),b4());});};u.Sink=function(b2,b3){function b4(){V.WhenRun(b3(),b2,function(){bK.scheduler().Fork(b4);});}bK.scheduler().Fork(b4);};u.CreateLazy=function(b2){var b3;b3={c:null,o:b2};return function(){var b4,b5;b4=b3.c;return b4===null?(b4=b3.o(),b3.c=b4,(b5=b4.s,b5!=null&&b5.$==0)?b3.o=null:V.WhenObsoleteRun(b4,function(){b3.c=null;}),b4):b4;};};u.Const=function(b2){var b3;b3=V.New({$:0,$0:b2});return function(){return b3;};};u.MapSeqCachedViewBy=function(b2,b3,b4){var b5;b5=[new _0.New$5()];return u.Map(function(b6){var b7,b8,b9;b7=b5[0];b8=new _0.New$5();b9=Y.mapInPlace(function(b_){var b$,ca,cb;b$=b2(b_);ca=b7.ContainsKey(b$)?(cb=b7.get_Item(b$),(r.Set(cb.r,b_),cb)):u.ConvertSeqNode(function(cc){return b3(b$,cc);},b_);b8.set_Item(b$,ca);return ca.e;},v.ofSeq(b6));b5[0]=b8;return b9;},b4);};u.Map3=function(b2,b3,b4,b5){return u.CreateLazy(function(){return V.Map3(b2,b3(),b4(),b5());});};u.Sequence=function(b2){return u.CreateLazy(function(){return V.Sequence(_3.map(function(b3){return b3();},b2));});};u.Map2Unit=function(b2,b3){return u.CreateLazy(function(){return V.Map2Unit(b2(),b3());});};u.ConvertSeqNode=function(b2,b3){var b4,b5;b4=r.Create$1(b3);b5=b4.get_View();return{e:b2(b5),r:b4,w:b5};};u.Bind=function(b2,b3){return u.Join(u.Map(b2,b3));};u.Join=function(b2){return u.CreateLazy(function(){return V.Join(b2());});};r=e.Var=bZ.Class({},o,r);r.New=bZ.Ctor(function(){},r);v.get=function(b2,b3){v.checkBounds(b2,b3);return b2[b3];};v.checkBounds=function(b2,b3){if(b3<0||b3>=b2.length)k.FailWith("Index was outside the bounds of the array.");};v.length=function(b2){return b2.dims===2?b2.length*b2.length:b2.length;};v.set=function(b2,b3,b4){v.checkBounds(b2,b3);b2[b3]=b4;};p.ofArray=function(b2){var b3,b4,b5;b3=q.Empty;for(b4=v.length(b2)-1,b5=0;b4>=b5;b4--)b3=new q({$:1,$0:v.get(b2,b4),$1:b3});return b3;};p.rev=function(b2){var b3,b4;b3=q.Empty;b4=b2;while(b4.$==1){b3=new q({$:1,$0:b4.$0,$1:b3});b4=b4.$1;}return b3;};p.filter=function(b2,b3){return p.ofSeq(_3.filter(b2,b3));};p.map=function(b2,b3){var b4,b5,b6,b7,b8;if(b3.$==0)return b3;else{b7=new q({$:1});b4=b7;b5=b3;b6=true;while(b6){b4.$0=b2(b5.$0);b5=b5.$1;b5.$==0?b6=false:b4=(b8=new q({$:1}),b4.$1=b8,b8);}b4.$1=q.Empty;return b7;}};p.ofSeq=function(b2){var b3,b4,b5,b6,b7,b8;if(b2 instanceof q)return b2;else if(b2 instanceof a.Array)return p.ofArray(b2);else{b3=bc.Get(b2);try{b5=b3.MoveNext();if(!b5)b4=q.Empty;else{b7=new q({$:1});b6=b7;while(b5){b6.$0=b3.Current();b3.MoveNext()?b6=(b8=new q({$:1}),b6.$1=b8,b8):b5=false;}b6.$1=q.Empty;b4=b7;}return b4;}finally{if("Dispose"in b3)b3.Dispose();}}};p.append=function(b2,b3){var b4,b5,b6,b7,b8;if(b2.$==0)return b3;else if(b3.$==0)return b2;else{b7=new q({$:1});b4=b7;b5=b2;b6=true;while(b6){b4.$0=b5.$0;b5=b5.$1;b5.$==0?b6=false:b4=(b8=new q({$:1}),b4.$1=b8,b8);}b4.$1=b3;return b7;}};p.head=function(b2){return b2.$==1?b2.$0:p.listEmpty();};p.tail=function(b2){return b2.$==1?b2.$1:p.listEmpty();};p.listEmpty=function(){return k.FailWith("The input list was empty.");};p.iter=function(b2,b3){var b4;b4=b3;while(b4.$==1){b2(p.head(b4));b4=p.tail(b4);}};w.DynamicClassPred=function(b2,b3){return W.Dynamic(b3,function(b4){return function(b5){return b5?X.AddClass(b4,b2):X.RemoveClass(b4,b2);};});};w.Handler=function(b2,b3){return W.Static(function(b4){b4.addEventListener(b2,function(b5){return(b3(b4))(b5);},false);});};w.OnAfterRender=function(b2){return new x({$:4,$0:b2});};w.Value=function(b2){function b3(b4){return{$:1,$0:b4};}return w.CustomValue(b2,a.id,function(b4){return b3(a.id(b4));});};w.Checked=function(b2){function b3(b4,b5){return!l.Equals(b2.Get(),b4.checked)?b2.Set(b4.checked):null;}return x.Concat([w.DynamicProp("checked",b2.get_View()),w.Handler("change",function(b4){return function(b5){return b3(b4,b5);};}),w.Handler("click",function(b4){return function(b5){return b3(b4,b5);};})]);};w.IntValue=function(b2){return w.CustomVar(b2,function(b3,b4){var b5;b5=b4.get_Input();return b3.value!==b5?void(b3.value=b5):null;},function(b3){var b4,b5,b6;b4=b3.value;return{$:1,$0:bI.isBlank(b4)?(b3.checkValidity?b3.checkValidity():true)?new bw({$:2,$0:b4}):new bw({$:1,$0:b4}):(b5=(b6=0,[R.TryParseInt32(b4,{get:function(){return b6;},set:function(b7){b6=b7;}}),b6]),b5[0]?new bw({$:0,$0:b5[1],$1:b4}):new bw({$:1,$0:b4}))};});};w.IntValueUnchecked=function(b2){return w.CustomValue(b2,a.String,function(b3){var b4;return bI.isBlank(b3)?{$:1,$0:0}:(b4=+b3,b4!==b4>>0?null:{$:1,$0:b4});});};w.FloatValue=function(b2){return w.CustomVar(b2,function(b3,b4){var b5;b5=b4.get_Input();return b3.value!==b5?void(b3.value=b5):null;},function(b3){var b4,b5;b4=b3.value;return{$:1,$0:bI.isBlank(b4)?(b3.checkValidity?b3.checkValidity():true)?new bw({$:2,$0:b4}):new bw({$:1,$0:b4}):(b5=+b4,a.isNaN(b5)?new bw({$:1,$0:b4}):new bw({$:0,$0:b5,$1:b4}))};});};w.FloatValueUnchecked=function(b2){return w.CustomValue(b2,a.String,function(b3){var b4;return bI.isBlank(b3)?{$:1,$0:0}:(b4=+b3,a.isNaN(b4)?null:{$:1,$0:b4});});};w.Dynamic=function(b2,b3){return W.Dynamic(b3,function(b4){return function(b5){return X.SetAttr(b4,b2,b5);};});};w.CustomValue=function(b2,b3,b4){return w.CustomVar(b2,function(b5,b6){b5.value=b3(b6);},function(b5){return b4(b5.value);});};w.DynamicProp=function(b2,b3){return W.Dynamic(b3,function(b4){return function(b5){b4[b2]=b5;};});};w.CustomVar=function(b2,b3,b4){function b5(b7,b8){return b2.UpdateMaybe(function(b9){var b_,b$;b_=b4(b7);return b_!=null&&b_.$==1&&(!l.Equals(b_.$0,b9)&&(b$=[b_,b_.$0],true))?b$[0]:null;});}function b6(b7,b8){var b9,b_;b9=b4(b7);return b9!=null&&b9.$==1&&(l.Equals(b9.$0,b8)&&(b_=b9.$0,true))?null:b3(b7,b8);}return x.Concat([w.Handler("change",function(b7){return function(b8){return b5(b7,b8);};}),w.Handler("input",function(b7){return function(b8){return b5(b7,b8);};}),w.Handler("keypress",function(b7){return function(b8){return b5(b7,b8);};}),w.DynamicCustom(function(b7){return function(b8){return b6(b7,b8);};},b2.get_View())]);};w.DynamicCustom=function(b2,b3){return W.Dynamic(b3,b2);};x=e.AttrProxy=bZ.Class({},null,x);x.Concat=function(b2){var b3;b3=Y.ofSeqNonCopying(b2);return Y.TreeReduce(W.EmptyAttr(),x.Append,b3);};x.Append=function(b2,b3){return W.AppendTree(b2,b3);};x.Handler=function(b2,b3){return x.HandlerImpl(b2,b3);};x.Create=function(b2,b3){return W.Static(function(b4){X.SetAttr(b4,b2,b3);});};x.HandlerImpl=function(b2,b3){return W.Static(function(b4){b4.addEventListener(b2,function(b5){return(b3(b4))(b5);},false);});};B.CompleteHoles=function(b2,b3,b4){var b6,b7,b8,b9,b_,b$;function b5(ca,cb){var cc,cd,ce,cf;return b7.Contains(ca)?null:(cc=cb===0?(cd=r.Create$1(""),[{$:7,$0:ca,$1:cd},cd]):cb===1?(ce=r.Create$1(0),[{$:12,$0:ca,$1:ce},ce]):cb===2?(cf=r.Create$1(false),[{$:8,$0:ca,$1:cf},cf]):k.FailWith("Invalid value type"),(b6.set_Item(ca,cc[1]),{$:1,$0:cc[0]}));}b6=new _0.New$5();b7=new _1.New$3();b8=bc.Get(b3);try{while(b8.MoveNext()){b9=b8.Current();(b9.$==7?(b_=[b9.$0,_2.Box(b9.$1)],true):b9.$==10?(b_=[b9.$0,_2.Box(b9.$1)],true):b9.$==9?(b_=[b9.$0,_2.Box(b9.$1)],true):b9.$==12?(b_=[b9.$0,_2.Box(b9.$1)],true):b9.$==11?(b_=[b9.$0,_2.Box(b9.$1)],true):b9.$==8&&(b_=[b9.$0,_2.Box(b9.$1)],true))?(b$=b_[0],b7.Add(b$),b6.set_Item(b$,b_[1])):void 0;}}finally{if("Dispose"in b8)b8.Dispose();}return[_3.append(b3,v.choose(function(ca){return b5(ca[0],ca[1]);},b4)),{$:0,$0:b6}];};C=A.TemplateInstance=bZ.Class({Hole:function(b2){return this.allVars.get_Item(b2);},get_Doc:function(){return this.doc;}},o,C);C.New=bZ.Ctor(function(b2,b3){this.doc=b3;this.allVars=b2.$==0?b2.$0:k.FailWith("Should not happen");},C);F.ClearCompleted={$:2};G.set_UseAnimations=function(b2){_4.$cctor();_4.UseAnimations=b2;};G.UseAnimations=function(){_4.$cctor();return _4.UseAnimations;};G.Actions=function(b2){return G.ConcatActions(v.choose(function(b3){return b3.$==1?{$:1,$0:b3.$0}:null;},bL.ToArray(b2.$0)));};G.Finalize=function(b2){v.iter(function(b3){if(b3.$==0)b3.$0();},bL.ToArray(b2.$0));};G.List=function(b2){return b2.$0;};G.ConcatActions=function(b2){var b3,b4,b5,b6;b3=Y.ofSeqNonCopying(b2);b4=v.length(b3);return b4===0?G.Const():b4===1?v.get(b3,0):(b5=_3.max(_3.map(function(b7){return b7.Duration;},b3)),(b6=v.map(function(b7){return G.Prolong(b5,b7);},b3),G.Def(b5,function(b7){v.iter(function(b8){b8.Compute(b7);},b6);})));};G.Const=function(b2){return G.Def(0,function(){return b2;});};G.Prolong=function(b2,b3){var b4,b5,b6;b4=b3.Compute;b5=b3.Duration;b6=bh.Create(function(){return b3.Compute(b3.Duration);});return{Compute:function(b7){return b7>=b5?b6.f():b4(b7);},Duration:b2};};G.Def=function(b2,b3){return{Compute:b3,Duration:b2};};I.JSUnion=function(b2,b3){var b4;function b5(b9){var b_;function b$(ca){return ca!=null&&ca.$==1&&l.Equals(b9,ca.$0);}b_=_3.tryFindIndex(function(ca){return b$(ca[0]);},b3);return b_!=null&&b_.$==1?b_.$0:b9.$;}function b6(b9,b_){return v.init(v.length((v.get(b3,b9))[2]),function(b$){return b_["$"+a.String(b$)];});}function b7(b9,b_){var b$,ca,cb;b$=b2==null?{}:new b2();ca=v.get(b3,b9);return(cb=ca[0],cb!=null&&cb.$==1)?ca[0].$0:(b$.$=b9,_3.iteri(function(cc,cd){b$["$"+a.String(cc)]=cd;},b_),b$);}function b8(b9,b_){var b$;function ca(cb,cc){return[b9,cb,cc,b$];}b$=b_[2];return _3.map(function(cb){return ca(cb[0],cb[1]);},b_[1]);}b4=_3.collect(function(b9){return b8(b9[0],b9[1]);},_3.indexed(b3));return _6.New$1(function(b9){function b_(b$,ca,cb,cc){var cd,ce,cf;function cg(ch,ci,cj){var ck;function cl(cm,cn){return cg(ck,cm,new q({$:1,$0:cn,$1:cj}));}return ch.$==1?(ck=ch.$1,_3.collect(function(cm){return cl(cm[0],cm[1]);},ch.$0.Parse(ci))):[[ci,b7(b$,v.ofList(p.rev(cj)))]];}return I.isCorrectMethod(ca,b9.Method)?(cd=_7.startsWith(p.ofArray(cb),b9.Segments),cd==null?[]:(ce=cd.$0,(cf=p.ofArray(cc),cf.$==0?[[J.New(ce,b9.QueryArgs,b9.FormData,b9.Method,b9.Body),b7(b$,[])]]:cg(cf,J.New(ce,b9.QueryArgs,b9.FormData,b9.Method,b9.Body),q.Empty)))):[];}return _3.collect(function(b$){return b_(b$[0],b$[1],b$[2],b$[3]);},b4);},function(b9){var b_,b$,ca,cb,cc,cd;function ce(cf,cg){return cg.Write(cf);}b_=b5(b9);b$=v.get(b3,b_);ca=b$[2];cb=v.get(b$[1],0);cc=[J.Segment(p.ofArray(cb[1]),cb[0])];return!l.Equals(ca,null)&&ca.length===0?{$:1,$0:cc}:(cd=(((bZ.Curried3(v.map2))(ce))(b6(b_,b9)))(ca),v.forall(function(cf){return cf!=null;},cd)?{$:1,$0:_3.append(cc,_3.collect(function(cf){return cf.$0;},cd))}:null);});};I.isCorrectMethod=function(b2,b3){return b3!=null&&b3.$==1?b2!=null&&b2.$==1?l.Equals(b3.$0,b2.$0):true:!(b2!=null&&b2.$==1);};J=H.Route=bZ.Class({ToLink:function(){return br.WriteLink(this.Segments,this.QueryArgs);}},null,J);J.FromHash=function(b2,b3){var b4,b5;b4=b2.indexOf("#");return b4===-1?J.get_Empty():(b5=b2.substring(b4+1),b3!=null&&b3.$0?b5===""||b5==="/"?J.get_Empty():_9.StartsWith(b5,"/")?J.FromUrl(b5.substring(1),{$:1,$0:true}):J.Segment$2(b5):J.FromUrl(b2.substring(b4),{$:1,$0:false}));};J.Segment=function(b2,b3){var b4;b4=J.get_Empty();return J.New(b2,b4.QueryArgs,b4.FormData,b3,b4.Body);};J.get_Empty=function(){return J.New(q.Empty,new bf.New([]),new bf.New([]),null,bh.CreateFromValue(null));};J.FromUrl=function(b2,b3){var b4,b5,b6;b4=(b5=b2.indexOf("?"),b5===-1?[b2,new bf.New([])]:[_9.Substring(b2,0,b5),J.ParseQuery(b2.substring(b5+1))]);b6=J.get_Empty();return J.New(p.ofArray(_9.SplitChars(b4[0],["/"],b3!=null&&b3.$0?0:1)),b4[1],b6.FormData,b6.Method,b6.Body);};J.Segment$2=function(b2){var b3;b3=J.get_Empty();return J.New(p.ofArray([b2]),b3.QueryArgs,b3.FormData,b3.Method,b3.Body);};J.ParseQuery=function(b2){return bg.OfArray(v.ofSeq(v.choose(function(b3){var b4,b5;b4=_9.SplitChars(b3,["="],0);return!l.Equals(b4,null)&&b4.length===2?(b5=v.get(b4,1),{$:1,$0:[v.get(b4,0),b5]}):((function(b6){return function(b7){return b6("wrong format for query argument: "+M.toSafe(b7));};}(function(b6){bW.log(b6);}))(b3),null);},_9.SplitChars(b2,["&"],0))));};J.Combine=function(b2){var b3,b4,b5,b6,b7,b8,b9,b_,b$,ca;b9=v.ofSeq(b2);b_=v.length(b9);if(b_===0)return J.get_Empty();else if(b_===1)return v.get(b9,0);else{b3=null;b4=null;b$=[];b5=new bf.New([]);b6=new bf.New([]);b7=0;ca=v.length(b9);while(b7<ca)(function(){var cb,cc,cd;cb=v.get(b9,b7);cc=cb.Method;cc!=null&&cc.$==1?b3=cc:void 0;cd=cb.Body.f();cd===null?void 0:b4=cd;b5=bg.FoldBack(function(ce,cf,cg){return cg.Add(ce,cf);},b5,cb.QueryArgs);b6=bg.FoldBack(function(ce,cf,cg){return cg.Add(ce,cf);},b6,cb.FormData);p.iter(function(ce){b$.push(ce);},cb.Segments);b7=b7+1;}());return J.New(p.ofSeq(b$),b5,b6,b3,bh.CreateFromValue(b4));}};J.New=function(b2,b3,b4,b5,b6){return new J({Segments:b2,QueryArgs:b3,FormData:b4,Method:b5,Body:b6});};K.Parse=function(b2,b3){function b4(b5,b6){return b5.Segments.$==0?{$:1,$0:b6}:null;}return _3.tryPick(function(b5){return b4(b5[0],b5[1]);},b2.Parse(b3));};K.HashLink=function(b2,b3){return"#"+K.Link(b2,b3);};K.Link=function(b2,b3){var b4;b4=K.Write(b2,b3);return b4==null?"":b4.$0.ToLink();};K.Write=function(b2,b3){var b4;b4=b2.Write(b3);return b4==null?null:{$:1,$0:J.Combine(b4.$0)};};M.toSafe=function(b2){return b2==null?"":b2;};v.choose=function(b2,b3){var b4,b5,b6,b7;b4=[];for(b5=0,b6=b3.length-1;b5<=b6;b5++){b7=b2(b3[b5]);b7==null?void 0:b4.push(b7.$0);}return b4;};v.init=function(b2,b3){var b4,b5,b6;b2<0?k.FailWith("Negative size given."):null;b4=new a.Array(b2);for(b5=0,b6=b2-1;b5<=b6;b5++)b4[b5]=b3(b5);return b4;};v.ofList=function(b2){var b3,b4;b4=[];b3=b2;while(!(b3.$==0)){b4.push(p.head(b3));b3=p.tail(b3);}return b4;};v.map2=function(b2,b3,b4){var b5,b6,b7;v.checkLength(b3,b4);b5=new a.Array(b4.length);for(b6=0,b7=b4.length-1;b6<=b7;b6++)b5[b6]=b2(b3[b6],b4[b6]);return b5;};v.forall=function(b2,b3){var b4,b5,b6,b7;b4=true;b5=0;b7=v.length(b3);while(b4&&b5<b7)if(b2(b3[b5]))b5=b5+1;else b4=false;return b4;};v.checkLength=function(b2,b3){if(b2.length!==b3.length)k.FailWith("The arrays have different lengths.");};v.pick=function(b2,b3){var b4;b4=v.tryPick(b2,b3);return b4==null?k.FailWith("KeyNotFoundException"):b4.$0;};v.tryFindIndex=function(b2,b3){var b4,b5;b4=null;b5=0;while(b5<b3.length&&b4==null){b2(b3[b5])?b4={$:1,$0:b5}:void 0;b5=b5+1;}return b4;};v.tryPick=function(b2,b3){var b4,b5,b6;b4=null;b5=0;while(b5<b3.length&&b4==null){b6=b2(b3[b5]);b6!=null&&b6.$==1?b4=b6:void 0;b5=b5+1;}return b4;};v.foldBack=function(b2,b3,b4){var b5,b6,b7,b8,b9;b5=b4;b7=b3.length;for(b8=1,b9=b7;b8<=b9;b8++)b5=b2(b3[b7-b8],b5);return b5;};v.iter=function(b2,b3){var b4,b5;for(b4=0,b5=b3.length-1;b4<=b5;b4++)b2(b3[b4]);};v.concat=function(b2){return a.Array.prototype.concat.apply([],v.ofSeq(b2));};v.exists=function(b2,b3){var b4,b5,b6,b7;b4=false;b5=0;b7=v.length(b3);while(!b4&&b5<b7)if(b2(b3[b5]))b4=true;else b5=b5+1;return b4;};v.map=function(b2,b3){var b4,b5,b6;b4=new a.Array(b3.length);for(b5=0,b6=b3.length-1;b5<=b6;b5++)b4[b5]=b2(b3[b5]);return b4;};v.filter=function(b2,b3){var b4,b5,b6;b4=[];for(b5=0,b6=b3.length-1;b5<=b6;b5++)if(b2(b3[b5]))b4.push(b3[b5]);return b4;};v.ofSeq=function(b2){var b3,b4;if(b2 instanceof a.Array)return b2.slice();else if(b2 instanceof q)return v.ofList(b2);else{b3=[];b4=bc.Get(b2);try{while(b4.MoveNext())b3.push(b4.Current());return b3;}finally{if("Dispose"in b4)b4.Dispose();}}};v.sortInPlace=function(b2){v.mapInPlace(function(b3){return b3[0];},v.mapiInPlace(function(b3,b4){return[b4,b3];},b2).sort(l.Compare));};v.create=function(b2,b3){var b4,b5,b6;b4=new a.Array(b2);for(b5=0,b6=b2-1;b5<=b6;b5++)b4[b5]=b3;return b4;};P.Id=function(){P.set_counter(P.counter()+1);return"uid"+a.String(P.counter());};P.set_counter=function(b2){bi.$cctor();bi.counter=b2;};P.counter=function(){bi.$cctor();return bi.counter;};P.Int=function(){P.set_counter(P.counter()+1);return P.counter();};Q.$cctor=function(){Q.$cctor=a.ignore;Q.model=r.Create$1(s.get_Empty());};R.TryParseInt32=function(b2,b3){return R.TryParse(b2,-2147483648,2147483647,b3);};S=e.Doc=bZ.Class({},o,S);S.TextView=function(b2){var b3;b3=_.CreateTextNode();return S.Mk({$:4,$0:b3},u.Map(function(b4){_.UpdateTextNode(b3,b4);},b2));};S.RunById=function(b2,b3){var b4;b4=X.Doc().getElementById(b2);l.Equals(b4,null)?k.FailWith("invalid id: "+b2):S.Run(b4,b3);};S.ConvertSeqVarBy=function(b2,b3,b4){return S.Flatten(r.MapLens(b2,b3,b4));};S.TextNode=function(b2){return S.Mk({$:5,$0:X.CreateText(b2)},u.Const());};S.Mk=function(b2,b3){return new S.New(b2,b3);};S.LoadLocalTemplates=function(b2){var b3;b3=_.LoadedTemplateFile("");b3.count>0?_.LoadedTemplates().set_Item(b2,b3):(function(){var b4,b5,b6,b7;while(true){b4=a.document.querySelector("[ws-template]");if(l.Equals(b4,null)){b5=a.document.querySelector("[ws-children-template]");if(l.Equals(b5,null))return null;else{b6=b5.getAttribute("ws-children-template");b5.removeAttribute("ws-children-template");S.PrepareTemplate(b2,{$:1,$0:b6},function(b8){return function(){return X.ChildrenArray(b8);};}(b5));}}else{b7=b4.getAttribute("ws-template");S.PrepareSingleTemplate(b2,{$:1,$0:b7},b4);}}}(),_.LoadedTemplates().set_Item("",_.LoadedTemplateFile(b2)));};S.NamedTemplate=function(b2,b3,b4){var b5,b6;b5=(b6=null,[_.LoadedTemplateFile(b2).TryGetValue(b3==null?"":b3.$0,{get:function(){return b6;},set:function(b7){b6=b7;}}),b6]);return b5[0]?S.ChildrenTemplate(b5[1].cloneNode(true),b4):(bW.warn("Local template doesn't exist",b3),S.Empty());};S.Run=function(b2,b3){var b4;S.LoadLocalTemplates$1();b4=b3.docNode;_.LinkElement(b2,b4);u.Sink(bl.StartProcessor(_.PerformAnimatedUpdate(_.CreateRunState(b2,b4),b4)),b3.updates);};S.Flatten=function(b2){return S.EmbedView(u.Map(S.Concat,b2));};S.PrepareTemplate=function(b2,b3,b4){var b5,b6,b7,b8,b9;if(!_.LoadedTemplateFile(b2).ContainsKey(b3==null?"":b3.$0)){b5=b4();for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=v.get(b5,b6);b9=b8.parentNode;l.Equals(b9,null)?void 0:b9.removeChild(b8);}S.PrepareTemplateStrict(b2,b3,b5);}};S.PrepareSingleTemplate=function(b2,b3,b4){var b5,b6,b7;b4.removeAttribute("ws-template");b5=b4.getAttribute("ws-replace");b5===null?void 0:(b4.removeAttribute("ws-replace"),b6=b4.parentNode,l.Equals(b6,null)?void 0:(b7=a.document.createElement(b4.tagName),b7.setAttribute("ws-replace",b5),b6.replaceChild(b7,b4)));S.PrepareTemplateStrict(b2,b3,[b4]);};S.ChildrenTemplate=function(b2,b3){var b4,b5,b6,b7,b8,b$,ca,cb,cc,cd,ce,cf;function b9(cg,ch){var ci,cj,ck;ci=W.Insert(cg,ch);ca.push(W.Updates(ci));cb.push([cg,ci]);cj=bZ.GetOptional(ci.OnAfterRender);return cj==null?null:(ck=cj.$0,void cc.push(function(){ck(cg);}));}function b_(cg){var ch,ci;ch=(ci=null,[cd.TryGetValue(cg,{get:function(){return ci;},set:function(cj){ci=cj;}}),ci]);return ch[0]?ch[1].$==0?{$:1,$0:ch[1].$1}:ch[1].$==1?{$:1,$0:S.TextNode(ch[1].$1)}:ch[1].$==2?{$:1,$0:S.TextView(ch[1].$1)}:ch[1].$==7?{$:1,$0:S.TextView(ch[1].$1.get_View())}:ch[1].$==8?{$:1,$0:S.TextView(u.Map(a.String,ch[1].$1.get_View()))}:ch[1].$==9?{$:1,$0:S.TextView(u.Map(function(cj){return cj.get_Input();},ch[1].$1.get_View()))}:ch[1].$==10?{$:1,$0:S.TextView(u.Map(a.String,ch[1].$1.get_View()))}:ch[1].$==11?{$:1,$0:S.TextView(u.Map(function(cj){return cj.get_Input();},ch[1].$1.get_View()))}:ch[1].$==12?{$:1,$0:S.TextView(u.Map(a.String,ch[1].$1.get_View()))}:(bW.warn("Content hole filled with attribute data",cg),null):null;}b$=[];ca=[];cb=[];cc=[];cd=new _0.New$5();ce=bc.Get(b3);try{while(ce.MoveNext()){cf=ce.Current();cd.set_Item(cf.$0,cf);}}finally{if("Dispose"in ce)ce.Dispose();}b4=X.ChildrenArray(b2);X.IterSelector(b2,"[ws-hole]",function(cg){var ch,ci,cj;cj=cg.getAttribute("ws-hole");cg.removeAttribute("ws-hole");while(cg.hasChildNodes())cg.removeChild(cg.lastChild);ch=b_(cj);ch!=null&&ch.$==1?(ci=ch.$0,_.LinkElement(cg,ci.docNode),b$.push(bt.New(W.Empty(cg),ci.docNode,null,cg,P.Int(),null)),ca.push(ci.updates)):void 0;});X.IterSelector(b2,"[ws-replace]",function(cg){var ch,ci,cj,ck,cl,cm;ch=b_(cg.getAttribute("ws-replace"));ch!=null&&ch.$==1?(ci=ch.$0,cj=cg.parentNode,ck=a.document.createTextNode(""),cj.replaceChild(ck,cg),cl=_.InsertBeforeDelim(ck,ci.docNode),cm=v.tryFindIndex(function(cn){return cg===cn;},b4),cm==null?void 0:v.set(b4,cm.$0,ci.docNode),b$.push(bt.New(W.Empty(cj),ci.docNode,{$:1,$0:[cl,ck]},cj,P.Int(),null)),ca.push(ci.updates)):void 0;});X.IterSelector(b2,"[ws-attr]",function(cg){var ch,ci,cj;ch=cg.getAttribute("ws-attr");cg.removeAttribute("ws-attr");ci=(cj=null,[cd.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);ci[0]?ci[1].$==3?b9(cg,ci[1].$1):bW.warn("Attribute hole filled with non-attribute data",ch):void 0;});X.IterSelector(b2,"[ws-on]",function(cg){b9(cg,x.Concat(v.choose(function(ch){var ci,cj,ck;ci=_9.SplitChars(ch,[":"],1);cj=(ck=null,[cd.TryGetValue(v.get(ci,1),{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);return cj[0]?cj[1].$==4?{$:1,$0:w.Handler(v.get(ci,0),cj[1].$1)}:cj[1].$==5?{$:1,$0:x.Handler(v.get(ci,0),cj[1].$2)}:(bW.warn("Event hole on"+v.get(ci,0)+" filled with non-event data",v.get(ci,1)),null):null;},_9.SplitChars(cg.getAttribute("ws-on"),[" "],1))));cg.removeAttribute("ws-on");});X.IterSelector(b2,"[ws-onafterrender]",function(cg){var ch,ci,cj;ch=cg.getAttribute("ws-onafterrender");ci=(cj=null,[cd.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);ci[0]?ci[1].$==6?(cg.removeAttribute("ws-onafterrender"),b9(cg,w.OnAfterRender(ci[1].$1))):bW.warn("onafterrender hole filled with non-onafterrender data",ch):void 0;});X.IterSelector(b2,"[ws-var]",function(cg){var ch,ci,cj;ch=cg.getAttribute("ws-var");cg.removeAttribute("ws-var");ci=(cj=null,[cd.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);ci[0]?ci[1].$==7?b9(cg,w.Value(ci[1].$1)):ci[1].$==8?b9(cg,w.Checked(ci[1].$1)):ci[1].$==9?b9(cg,w.IntValue(ci[1].$1)):ci[1].$==10?b9(cg,w.IntValueUnchecked(ci[1].$1)):ci[1].$==11?b9(cg,w.FloatValue(ci[1].$1)):ci[1].$==12?b9(cg,w.FloatValueUnchecked(ci[1].$1)):bW.warn("Var hole filled with non-Var data",ch):void 0;});X.IterSelector(b2,"[ws-attr-holes]",function(cg){var ch,ci,cj,ck;ch=new a.RegExp(_.TextHoleRE(),"g");ci=_9.SplitChars(cg.getAttribute("ws-attr-holes"),[" "],1);cg.removeAttribute("ws-attr-holes");for(cj=0,ck=ci.length-1;cj<=ck;cj++)(function(){var cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx;cu=v.get(ci,cj);cv=cg.getAttribute(cu);cl=null;cm=0;cw=[];while(cl=ch.exec(cv),cl!==null){cx=bx.string(cv,{$:1,$0:cm},{$:1,$0:ch.lastIndex-v.get(cl,0).length-1});cm=ch.lastIndex;cw.push([cx,v.get(cl,1)]);}co=bx.string(cv,{$:1,$0:cm},null);ch.lastIndex=0;cp=v.foldBack(function(cy,cz){return(function(cA){var cB,cC;cB=cA[0];cC=cA[1];return function(cD){var cE,cF,cG,cH,cI;cE=cD[0];cF=cD[1];cG=(cH=(cI=null,[cd.TryGetValue(cC,{get:function(){return cI;},set:function(cJ){cI=cJ;}}),cI]),cH[0]?cH[1].$==1?{$:0,$0:cH[1].$1}:cH[1].$==2?{$:1,$0:cH[1].$1}:cH[1].$==7?{$:1,$0:cH[1].$1.get_View()}:cH[1].$==8?{$:1,$0:u.Map(a.String,cH[1].$1.get_View())}:cH[1].$==9?{$:1,$0:u.Map(function(cJ){return cJ.get_Input();},cH[1].$1.get_View())}:cH[1].$==10?{$:1,$0:u.Map(a.String,cH[1].$1.get_View())}:cH[1].$==11?{$:1,$0:u.Map(function(cJ){return cJ.get_Input();},cH[1].$1.get_View())}:cH[1].$==12?{$:1,$0:u.Map(a.String,cH[1].$1.get_View())}:(bW.warn("Attribute value hole filled with non-text data",cC),{$:0,$0:""}):{$:0,$0:""});return cG.$==1?[cB,new q({$:1,$0:cE===""?cG.$0:u.Map(function(cJ){return cJ+cE;},cG.$0),$1:cF})]:[cB+cG.$0+cE,cF];};}(cy))(cz);},cw,[co,q.Empty]);return b9(cg,cp[1].$==1?cp[1].$1.$==1?cp[1].$1.$1.$==1?cp[1].$1.$1.$1.$==0?(cq=cp[0],w.Dynamic(cu,u.Map3(function(cy,cz,cA){return cq+cy+cz+cA;},cp[1].$0,cp[1].$1.$0,cp[1].$1.$1.$0))):(cr=cp[0],w.Dynamic(cu,u.Map(function(cy){return cr+_9.concat("",cy);},u.Sequence(cp[1])))):(cs=cp[0],w.Dynamic(cu,u.Map2(function(cy,cz){return cs+cy+cz;},cp[1].$0,cp[1].$1.$0))):cp[0]===""?w.Dynamic(cu,cp[1].$0):(ct=cp[0],w.Dynamic(cu,u.Map(function(cy){return ct+cy;},cp[1].$0))):x.Create(cu,cp[0]));}());});b5=bZ.DeleteEmptyFields({Els:b4,Dirty:true,Holes:b$,Attrs:cb,Render:(b6=cc.length==0?null:{$:1,$0:function(cg){v.iter(function(ch){ch(cg);},cc);}},b6?b6.$0:void 0)},["Render"]);b7=Y.TreeReduce(u.Const(),u.Map2Unit,ca);return!l.Equals(b4,null)&&b4.length===1&&(v.get(b4,0)instanceof N&&(l.Equals(v.get(b4,0).nodeType,N.ELEMENT_NODE)&&(b8=v.get(b4,0),true)))?by.TreeNode(b5,b7):S.Mk({$:6,$0:b5},b7);};S.Empty=function(){return S.Mk(null,u.Const());};S.LoadLocalTemplates$1=function(){if(!_.LocalTemplatesLoaded()){_.set_LocalTemplatesLoaded(true);S.LoadLocalTemplates("");}};S.Concat=function(b2){var b3;b3=Y.ofSeqNonCopying(b2);return Y.TreeReduce(S.Empty(),S.Append,b3);};S.EmbedView=function(b2){var b3;b3=_.CreateEmbedNode();return S.Mk({$:2,$0:b3},u.Map(a.ignore,u.Bind(function(b4){_.UpdateEmbedNode(b3,b4.docNode);return b4.updates;},b2)));};S.PrepareTemplateStrict=function(b2,b3,b4){var b5,b6;function b7(ch){var cj,ck,cl,cm,cn,co,cp,cq;function ci(cr){var cs;cs=ch.getAttribute(cr);cs===null?void 0:ch.setAttribute(cr,cs.toLowerCase());}cj=ch.attributes;ck=[];cl=[];cm=[];for(cn=0,co=cj.length-1;cn<=co;cn++){cp=cj.item(cn);_9.StartsWith(cp.nodeName,"ws-on")&&cp.nodeName!=="ws-onafterrender"&&cp.nodeName!=="ws-on"?(ck.push(cp.nodeName),cl.push(bx.string(cp.nodeName,{$:1,$0:"ws-on".length},null)+":"+cp.nodeValue.toLowerCase())):!_9.StartsWith(cp.nodeName,"ws-")&&(new a.RegExp(_.TextHoleRE())).test(cp.nodeValue)?(cp.nodeValue=(cq=new a.RegExp(_.TextHoleRE(),"g"),cp.nodeValue.replace(cq,function(cr,cs){return"${"+cs.toLowerCase()+"}";})),cm.push(cp.nodeName)):void 0;}!(cl.length==0)?ch.setAttribute("ws-on",_9.concat(" ",cl)):void 0;!(cm.length==0)?ch.setAttribute("ws-attr-holes",_9.concat(" ",cm)):void 0;ci("ws-hole");ci("ws-replace");ci("ws-attr");ci("ws-onafterrender");ci("ws-var");v.iter(function(cr){ch.removeAttribute(cr);},ck);}function b8(ch){var ci,cj,ck,cl,cm,cn;ci=null;cj=0;cl=ch.textContent;cm=new a.RegExp(_.TextHoleRE(),"g");while(ci=cm.exec(cl),ci!==null){ch.parentNode.insertBefore(a.document.createTextNode(bx.string(cl,{$:1,$0:cj},{$:1,$0:cm.lastIndex-v.get(ci,0).length-1})),ch);cj=cm.lastIndex;cn=a.document.createElement("span");cn.setAttribute("ws-replace",v.get(ci,1).toLowerCase());ch.parentNode.insertBefore(cn,ch);}cm.lastIndex=0;ch.textContent=bx.string(cl,{$:1,$0:cj},null);}function b9(ch,ci){function cj(ck){X.IterSelector(ch,"["+ck+"]",function(cl){var cm,cn;cm=(cn=null,[ci.TryGetValue(cl.getAttribute(ck).toLowerCase(),{get:function(){return cn;},set:function(co){cn=co;}}),cn]);cm[0]?cl.setAttribute(ck,cm[1]):void 0;});}cj("ws-hole");cj("ws-replace");cj("ws-attr");cj("ws-onafterrender");cj("ws-var");X.IterSelector(ch,"[ws-on]",function(ck){ck.setAttribute("ws-on",_9.concat(" ",v.map(function(cl){var cm,cn,co;cm=_9.SplitChars(cl,[":"],1);cn=(co=null,[ci.TryGetValue(v.get(cm,1),{get:function(){return co;},set:function(cp){co=cp;}}),co]);return cn[0]?v.get(cm,0)+":"+cn[1]:cl;},_9.SplitChars(ck.getAttribute("ws-on"),[" "],1))));});return X.IterSelector(ch,"[ws-attr-holes]",function(ck){var cl,cm,cn;cl=_9.SplitChars(ck.getAttribute("ws-attr-holes"),[" "],1);for(cm=0,cn=cl.length-1;cm<=cn;cm++)(function(){var co;function cp(cq,cr){var cs;cs=k.KeyValue(cr);return cq.replace(new a.RegExp("\\${"+cs[0]+"}","ig"),"${"+cs[1]+"}");}co=v.get(cl,cm);return ck.setAttribute(co,(((bZ.Curried3(_3.fold))(cp))(ck.getAttribute(co)))(ci));}());});}function b_(ch,ci){var cj,ck,cl,cm,cn;b7(ci);cj=ci.nodeName.toLowerCase();ck=ch.querySelector("[ws-attr="+cj+"]");if(l.Equals(ck,null))return bW.warn("Filling non-existent attr hole",cj);else{ck.removeAttribute("ws-attr");for(cl=0,cm=ci.attributes.length-1;cl<=cm;cl++){cn=ci.attributes.item(cl);cn.name==="class"&&ck.hasAttribute("class")?ck.setAttribute("class",ck.getAttribute("class")+" "+cn.nodeValue):ck.setAttribute(cn.name,cn.nodeValue);}return;}}function b$(ch,ci){function cj(ck){X.IterSelector(ch,"["+ck+"]",function(cl){if(!ci.Contains(cl.getAttribute(ck)))cl.removeAttribute(ck);});}cj("ws-attr");cj("ws-onafterrender");cj("ws-var");X.IterSelector(ch,"[ws-hole]",function(ck){if(!ci.Contains(ck.getAttribute("ws-hole"))){ck.removeAttribute("ws-hole");while(ck.hasChildNodes())ck.removeChild(ck.lastChild);}});X.IterSelector(ch,"[ws-replace]",function(ck){if(!ci.Contains(ck.getAttribute("ws-replace")))ck.parentNode.removeChild(ck);});X.IterSelector(ch,"[ws-on]",function(ck){ck.setAttribute("ws-on",_9.concat(" ",v.filter(function(cl){return ci.Contains(v.get(_9.SplitChars(cl,[":"],1),1));},_9.SplitChars(ck.getAttribute("ws-on"),[" "],1))));});return X.IterSelector(ch,"[ws-attr-holes]",function(ck){var cl,cm,cn,co,cp;cl=_9.SplitChars(ck.getAttribute("ws-attr-holes"),[" "],1);for(cm=0,cn=cl.length-1;cm<=cn;cm++){co=v.get(cl,cm);ck.setAttribute(co,(cp=new a.RegExp(_.TextHoleRE(),"g"),ck.getAttribute(co).replace(cp,function(cq,cr){return ci.Contains(cr)?cq:"";})));}});}function ca(ch,ci){var cj;cj=ch.querySelector("[ws-replace]");return l.Equals(cj,null)?(bW.warn("Filling non-existent text hole",b3),null):(cj.parentNode.replaceChild(new a.Text(ci),cj),{$:1,$0:cj.getAttribute("ws-replace")});}function cb(ch,ci,cj){while(true)if(ch.hasChildNodes())cj=ci.insertBefore(ch.lastChild,cj);else return null;}function cc(ch,ci,cj){var ck,cl,cm,cn,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK;function co(cL){}while(true)switch(ch){case 0:cp=bx.string(ci.nodeName,{$:1,$0:3},null).toLowerCase();cq=(ck=cp.indexOf("."),ck===-1?[b2,cp]:[bx.string(cp,null,{$:1,$0:ck-1}),bx.string(cp,{$:1,$0:ck+1},null)]);cr=cq[1];cs=cq[0];if(!_.LoadedTemplates().ContainsKey(cs))return bW.warn("Instantiating non-loaded template",cr);else{ct=_.LoadedTemplates().get_Item(cs);if(!ct.ContainsKey(cr))return bW.warn("Instantiating non-loaded template",cr);else{cu=ct.get_Item(cr);cv=cu.cloneNode(true);cw=new _1.New$3();cx=new _0.New$5();cy=ci.attributes;for(cz=0,cA=cy.length-1;cz<=cA;cz++){cB=cy.item(cz).name.toLowerCase();cx.set_Item(cB,(cC=cy.item(cz).nodeValue,cC===""?cB:cC.toLowerCase()));!cw.Add(cB)?bW.warn("Hole mapped twice",cB):void 0;}for(cD=0,cE=ci.childNodes.length-1;cD<=cE;cD++){cF=ci.childNodes[cD];l.Equals(cF.nodeType,N.ELEMENT_NODE)?!cw.Add(cF.nodeName.toLowerCase())?bW.warn("Hole filled twice",cr):void 0:void 0;}cG=ci.childNodes.length===1&&l.Equals(ci.firstChild.nodeType,N.TEXT_NODE);if(cG){cm=ca(cv,ci.firstChild.textContent);((function(cL){return function(cM){if(cM!=null)cL(cM.$0);};}((cn=function(cL){return function(cM){return cL.Add(cM);};}(cw),function(cL){return co(cn(cL));})))(cm));}b$(cv,cw);if(!cG){for(cH=0,cI=ci.childNodes.length-1;cH<=cI;cH++){cJ=ci.childNodes[cH];l.Equals(cJ.nodeType,N.ELEMENT_NODE)?cJ.hasAttributes()?b_(cv,cJ):cd(cv,cJ):void 0;}}b9(cv,cx);(((function(cL){function cM(cN,cO){return cb(cL,cN,cO);}return function(cN){return function(cO){return cM(cN,cO);};};}(cv))(ci.parentNode))(ci));ci.parentNode.removeChild(ci);return;}}break;case 1:if(cj!==null){cK=cj.nextSibling;if(l.Equals(cj.nodeType,N.TEXT_NODE))b8(cj);else if(l.Equals(cj.nodeType,N.ELEMENT_NODE))cf(cj);cj=cK;}else return null;break;}}function cd(ch,ci){var cj,cl,cm;function ck(cn,co){var cp,cq,cr;if(cl==="title"&&ci.hasChildNodes()){cp=b0.parseHTML(ci.textContent);ci.removeChild(ci.firstChild);for(cq=0,cr=cp.length-1;cq<=cr;cq++)ci.appendChild(v.get(cp,cq));}else null;cf(ci);return cb(ci,cn,co);}cl=ci.nodeName.toLowerCase();X.IterSelector(ch,"[ws-attr-holes]",function(cn){var co,cp,cq,cr,cs;co=_9.SplitChars(cn.getAttribute("ws-attr-holes"),[" "],1);for(cp=0,cq=co.length-1;cp<=cq;cp++){cr=v.get(co,cp);cn.setAttribute(cr,(cs=new a.RegExp("\\${"+cl+"}","ig"),cn.getAttribute(cr).replace(cs,ci.textContent)));}});cm=ch.querySelector("[ws-hole="+cl+"]");if(l.Equals(cm,null)){cj=ch.querySelector("[ws-replace="+cl+"]");return l.Equals(cj,null)?null:(ck(cj.parentNode,cj),void cj.parentNode.removeChild(cj));}else{while(cm.hasChildNodes())cm.removeChild(cm.lastChild);cm.removeAttribute("ws-hole");return ck(cm,null);}}function ce(ch){return cc(0,ch);}function cf(ch){var ci,cj;if(_9.StartsWith(ch.nodeName.toLowerCase(),"ws-")&&!ch.hasAttribute("ws-template"))ce(ch);else{b7(ch);ci=ch.getAttribute("ws-template");if(ci===null){cj=ch.getAttribute("ws-children-template");if(cj===null)cg(ch,ch.firstChild);else{ch.removeAttribute("ws-children-template");S.PrepareTemplate(b2,{$:1,$0:cj},function(){return X.ChildrenArray(ch);});while(ch.hasChildNodes())ch.removeChild(ch.lastChild);}}else S.PrepareSingleTemplate(b2,{$:1,$0:ci},ch);}}function cg(ch,ci){return cc(1,ch,ci);}b5=S.FakeRoot(b4);b6=(b3==null?"":b3.$0).toLowerCase();_.LoadedTemplateFile(b2).set_Item(b6,b5);v.length(b4)>0?cg(b5,v.get(b4,0)):void 0;};S.Append=function(b2,b3){return S.Mk({$:0,$0:b2.docNode,$1:b3.docNode},u.Map2Unit(b2.updates,b3.updates));};S.FakeRoot=function(b2){var b3,b4,b5;b3=a.document.createElement("div");for(b4=0,b5=b2.length-1;b4<=b5;b4++)b3.appendChild(v.get(b2,b4));return b3;};S.New=bZ.Ctor(function(b2,b3){this.docNode=b2;this.updates=b3;},S);U.NewFromSeq=function(b2){var b3,b4,b5;b3={};b4=bc.Get(b2);try{while(b4.MoveNext()){b5=b4.Current();b3[b5[0]]=b5[1];}}finally{if("Dispose"in b4)b4.Dispose();}return b3;};V.Map=function(b2,b3){var b4,b5;b4=b3.s;return b4!=null&&b4.$==0?V.New({$:0,$0:b2(b4.$0)}):(b5=V.New({$:3,$0:[],$1:[]}),(V.When(b3,function(b6){V.MarkDone(b5,b3,b2(b6));},b5),b5));};V.Map2=function(b2,b3,b4){var b5,b6,b7;function b8(b9){var b_,b$,ca;if(!(b_=b7.s,b_!=null&&b_.$==0||b_!=null&&b_.$==2)){b$=V.ValueAndForever(b3);ca=V.ValueAndForever(b4);b$!=null&&b$.$==1?ca!=null&&ca.$==1?b$.$0[1]&&ca.$0[1]?V.MarkForever(b7,b2(b$.$0[0],ca.$0[0])):V.MarkReady(b7,b2(b$.$0[0],ca.$0[0])):void 0:void 0;}}b5=b3.s;b6=b4.s;return b5!=null&&b5.$==0?b6!=null&&b6.$==0?V.New({$:0,$0:b2(b5.$0,b6.$0)}):V.Map2Opt1(b2,b5.$0,b4):b6!=null&&b6.$==0?V.Map2Opt2(b2,b6.$0,b3):(b7=V.New({$:3,$0:[],$1:[]}),(V.When(b3,b8,b7),V.When(b4,b8,b7),b7));};V.WhenRun=function(b2,b3,b4){var b5;b5=b2.s;b5==null?b4():b5!=null&&b5.$==2?(b5.$1.push(b4),b3(b5.$0)):b5!=null&&b5.$==3?(b5.$0.push(b3),b5.$1.push(b4)):b3(b5.$0);};V.WhenObsoleteRun=function(b2,b3){var b4;b4=b2.s;b4==null?b3():b4!=null&&b4.$==2?b4.$1.push(b3):b4!=null&&b4.$==3?b4.$1.push(b3):void 0;};V.When=function(b2,b3,b4){var b5;b5=b2.s;b5==null?V.Obsolete(b4):b5!=null&&b5.$==2?(V.EnqueueSafe(b5.$1,b4),b3(b5.$0)):b5!=null&&b5.$==3?(b5.$0.push(b3),V.EnqueueSafe(b5.$1,b4)):b3(b5.$0);};V.MarkDone=function(b2,b3,b4){var b5;if(b5=b3.s,b5!=null&&b5.$==0)V.MarkForever(b2,b4);else V.MarkReady(b2,b4);};V.Map2Opt1=function(b2,b3,b4){return V.Map(function(b5){return b2(b3,b5);},b4);};V.Map2Opt2=function(b2,b3,b4){return V.Map(function(b5){return b2(b5,b3);},b4);};V.ValueAndForever=function(b2){var b3;b3=b2.s;return b3!=null&&b3.$==0?{$:1,$0:[b3.$0,true]}:b3!=null&&b3.$==2?{$:1,$0:[b3.$0,false]}:null;};V.MarkForever=function(b2,b3){var b4,b5,b6,b7;b4=b2.s;if(b4!=null&&b4.$==3){b2.s={$:0,$0:b3};b5=b4.$0;for(b6=0,b7=v.length(b5)-1;b6<=b7;b6++)(v.get(b5,b6))(b3);}else void 0;};V.MarkReady=function(b2,b3){var b4,b5,b6,b7;b4=b2.s;if(b4!=null&&b4.$==3){b2.s={$:2,$0:b3,$1:b4.$1};b5=b4.$0;for(b6=0,b7=v.length(b5)-1;b6<=b7;b6++)(v.get(b5,b6))(b3);}else void 0;};V.EnqueueSafe=function(b2,b3){var b4,b5,b6,b7;b2.push(b3);if(b2.length%20===0){b4=b2.slice(0);bH.Clear(b2);for(b5=0,b6=v.length(b4)-1;b5<=b6;b5++){b7=v.get(b4,b5);typeof b7=="object"?function(b8){if(b8.s)b2.push(b8);}(b7):function(b8){b2.push(b8);}(b7);}}else void 0;};V.Map3=function(b2,b3,b4,b5){var b6,b7,b8,b9;function b_(b$){var ca,cb,cc,cd;if(!(ca=b9.s,ca!=null&&ca.$==0||ca!=null&&ca.$==2)){cb=V.ValueAndForever(b3);cc=V.ValueAndForever(b4);cd=V.ValueAndForever(b5);cb!=null&&cb.$==1?cc!=null&&cc.$==1?cd!=null&&cd.$==1?cb.$0[1]&&cc.$0[1]&&cd.$0[1]?V.MarkForever(b9,b2(cb.$0[0],cc.$0[0],cd.$0[0])):V.MarkReady(b9,b2(cb.$0[0],cc.$0[0],cd.$0[0])):void 0:void 0:void 0;}}b6=b3.s;b7=b4.s;b8=b5.s;return b6!=null&&b6.$==0?b7!=null&&b7.$==0?b8!=null&&b8.$==0?V.New({$:0,$0:b2(b6.$0,b7.$0,b8.$0)}):V.Map3Opt1(b2,b6.$0,b7.$0,b5):b8!=null&&b8.$==0?V.Map3Opt2(b2,b6.$0,b8.$0,b4):V.Map3Opt3(b2,b6.$0,b4,b5):b7!=null&&b7.$==0?b8!=null&&b8.$==0?V.Map3Opt4(b2,b7.$0,b8.$0,b3):V.Map3Opt5(b2,b7.$0,b3,b5):b8!=null&&b8.$==0?V.Map3Opt6(b2,b8.$0,b3,b4):(b9=V.New({$:3,$0:[],$1:[]}),(V.When(b3,b_,b9),V.When(b4,b_,b9),V.When(b5,b_,b9),b9));};V.Sequence=function(b2){var b3,b4,b5;function b6(b7){var b8;if(b5[0]===0){b8=v.map(function(b9){var b_;b_=b9.s;return b_!=null&&b_.$==0?b_.$0:b_!=null&&b_.$==2?b_.$0:k.FailWith("value not found by View.Sequence");},b3);v.forall(function(b9){var b_;b_=b9.s;return b_!=null&&b_.$==0;},b3)?V.MarkForever(b4,b8):V.MarkReady(b4,b8);}else b5[0]--;}b3=v.ofSeq(b2);return b3.length==0?V.New({$:0,$0:[]}):(b4=V.New({$:3,$0:[],$1:[]}),(b5=[v.length(b3)-1],(v.iter(function(b7){V.When(b7,b6,b4);},b3),b4)));};V.Map2Unit=function(b2,b3){var b4,b5,b6;function b7(){var b8,b9,b_;if(!(b8=b6.s,b8!=null&&b8.$==0||b8!=null&&b8.$==2)){b9=V.ValueAndForever(b2);b_=V.ValueAndForever(b3);b9!=null&&b9.$==1?b_!=null&&b_.$==1?b9.$0[1]&&b_.$0[1]?V.MarkForever(b6,null):V.MarkReady(b6,null):void 0:void 0;}}b4=b2.s;b5=b3.s;return b4!=null&&b4.$==0?b5!=null&&b5.$==0?V.New({$:0,$0:null}):b3:b5!=null&&b5.$==0?b2:(b6=V.New({$:3,$0:[],$1:[]}),(V.When(b2,b7,b6),V.When(b3,b7,b6),b6));};V.Map3Opt1=function(b2,b3,b4,b5){return V.Map(function(b6){return b2(b3,b4,b6);},b5);};V.Map3Opt2=function(b2,b3,b4,b5){return V.Map(function(b6){return b2(b3,b6,b4);},b5);};V.Map3Opt3=function(b2,b3,b4,b5){return V.Map2(function(b6,b7){return b2(b3,b6,b7);},b4,b5);};V.Map3Opt4=function(b2,b3,b4,b5){return V.Map(function(b6){return b2(b6,b3,b4);},b5);};V.Map3Opt5=function(b2,b3,b4,b5){return V.Map2(function(b6,b7){return b2(b6,b3,b7);},b4,b5);};V.Map3Opt6=function(b2,b3,b4,b5){return V.Map2(function(b6,b7){return b2(b6,b7,b3);},b4,b5);};V.Copy=function(b2){var b3,b4,b5;b3=b2.s;return b3==null?b2:b3!=null&&b3.$==2?(b4=V.New({$:2,$0:b3.$0,$1:[]}),(V.WhenObsolete(b2,b4),b4)):b3!=null&&b3.$==3?(b5=V.New({$:3,$0:[],$1:[]}),(V.When(b2,function(b6){V.MarkDone(b5,b2,b6);},b5),b5)):b2;};V.Join=function(b2){var b3;b3=V.New({$:3,$0:[],$1:[]});V.When(b2,function(b4){var b5;b5=b4();V.When(b5,function(b6){var b7,b8;if((b7=b5.s,b7!=null&&b7.$==0)&&(b8=b2.s,b8!=null&&b8.$==0))V.MarkForever(b3,b6);else V.MarkReady(b3,b6);},b3);},b3);return b3;};V.WhenObsolete=function(b2,b3){var b4;b4=b2.s;b4==null?V.Obsolete(b3):b4!=null&&b4.$==2?V.EnqueueSafe(b4.$1,b3):b4!=null&&b4.$==3?V.EnqueueSafe(b4.$1,b3):void 0;};W.Dynamic=function(b2,b3){return new x({$:1,$0:new $.New(b2,b3)});};W.EmptyAttr=function(){bj.$cctor();return bj.EmptyAttr;};W.AppendTree=function(b2,b3){var b4;return b2===null?b3:b3===null?b2:(b4=new x({$:2,$0:b2,$1:b3}),(W.SetFlags(b4,W.Flags(b2)|W.Flags(b3)),b4));};W.SetFlags=function(b2,b3){b2.flags=b3;};W.Flags=function(b2){return b2!==null&&b2.hasOwnProperty("flags")?b2.flags:0;};W.Insert=function(b2,b3){var b4,b5,b6;function b7(b8){if(!(b8===null))if(b8!=null&&b8.$==1)b4.push(b8.$0);else if(b8!=null&&b8.$==2){b7(b8.$0);b7(b8.$1);}else if(b8!=null&&b8.$==3)b8.$0(b2);else if(b8!=null&&b8.$==4)b5.push(b8.$0);}b4=[];b5=[];b7(b3);b6=b4.slice(0);return bG.New(b2,W.Flags(b3),b6,b5.length===0?null:{$:1,$0:function(b8){_3.iter(function(b9){b9(b8);},b5);}});};W.Updates=function(b2){return Y.MapTreeReduce(function(b3){return b3.NChanged();},u.Const(),u.Map2Unit,b2.DynNodes);};W.Empty=function(b2){return bG.New(b2,0,[],null);};W.Static=function(b2){return new x({$:3,$0:b2});};W.HasChangeAnim=function(b2){var b3;b3=4;return(b2.DynFlags&b3)===b3;};W.GetChangeAnim=function(b2){return W.GetAnim(b2,function(b3,b4){return b3.NGetChangeAnim(b4);});};W.HasEnterAnim=function(b2){var b3;b3=1;return(b2.DynFlags&b3)===b3;};W.GetEnterAnim=function(b2){return W.GetAnim(b2,function(b3,b4){return b3.NGetEnterAnim(b4);});};W.HasExitAnim=function(b2){var b3;b3=2;return(b2.DynFlags&b3)===b3;};W.GetExitAnim=function(b2){return W.GetAnim(b2,function(b3,b4){return b3.NGetExitAnim(b4);});};W.GetAnim=function(b2,b3){return f.Concat(v.map(function(b4){return b3(b4,b2.DynElem);},b2.DynNodes));};W.Sync=function(b2,b3){v.iter(function(b4){b4.NSync(b2);},b3.DynNodes);};X.AddClass=function(b2,b3){b0(b2).addClass(b3);};X.RemoveClass=function(b2,b3){b0(b2).removeClass(b3);};X.Doc=function(){bk.$cctor();return bk.Doc;};X.CreateText=function(b2){return X.Doc().createTextNode(b2);};X.ChildrenArray=function(b2){var b3,b4,b5;b3=[];for(b4=0,b5=b2.childNodes.length-1;b4<=b5;b4++)b3.push(b2.childNodes[b4]);return b3;};X.IterSelector=function(b2,b3,b4){var b5,b6,b7;b5=b2.querySelectorAll(b3);for(b6=0,b7=b5.length-1;b6<=b7;b6++)b4(b5[b6]);};X.SetAttr=function(b2,b3,b4){b2.setAttribute(b3,b4);};X.InsertAt=function(b2,b3,b4){var b5;if(!(b4.parentNode===b2&&b3===(b5=b4.nextSibling,l.Equals(b5,null)?null:b5)))b2.insertBefore(b4,b3);};X.RemoveNode=function(b2,b3){if(b3.parentNode===b2)b2.removeChild(b3);};Y.ofSeqNonCopying=function(b2){var b3,b4;if(b2 instanceof a.Array)return b2;else if(b2 instanceof q)return v.ofList(b2);else if(b2===null)return[];else{b3=[];b4=bc.Get(b2);try{while(b4.MoveNext())b3.push(b4.Current());return b3;}finally{if("Dispose"in b4)b4.Dispose();}}};Y.TreeReduce=function(b2,b3,b4){var b5;function b6(b7,b8){var b9,b_;return b8<=0?b2:b8===1&&(b7>=0&&b7<b5)?v.get(b4,b7):(b_=b8/2>>0,b3(b6(b7,b_),b6(b7+b_,b8-b_)));}b5=v.length(b4);return b6(0,b5);};Y.mapInPlace=function(b2,b3){var b4,b5;for(b4=0,b5=b3.length-1;b4<=b5;b4++)b3[b4]=b2(b3[b4]);return b3;};Y.MapTreeReduce=function(b2,b3,b4,b5){var b6;function b7(b8,b9){var b_,b$;return b9<=0?b3:b9===1&&(b8>=0&&b8<b6)?b2(v.get(b5,b8)):(b$=b9/2>>0,b4(b7(b8,b$),b7(b8+b$,b9-b$)));}b6=v.length(b5);return b7(0,b6);};_0=Z.Dictionary=bZ.Class({get_Item:function(b2){return this.get(b2);},set_Item:function(b2,b3){this.set(b2,b3);},get:function(b2){var b3,b4;b3=this;b4=this.data[this.hash(b2)];return b4?v.pick(function(b5){var b6;b6=k.KeyValue(b5);return b3.equals.apply(null,[b6[0],b2])?{$:1,$0:b6[1]}:null;},b4):bb.notPresent();},set:function(b2,b3){var b4,b5,b6,b7;b4=this;b5=this.hash(b2);b6=this.data[b5];b6?(b7=v.tryFindIndex(function(b8){return b4.equals.apply(null,[(k.KeyValue(b8))[0],b2]);},b6),b7==null?(this.count=this.count+1,b6.push({K:b2,V:b3})):b6[b7.$0]={K:b2,V:b3}):(this.count=this.count+1,this.data[b5]=new a.Array({K:b2,V:b3}));},TryGetValue:function(b2,b3){var b4,b5,b6;b4=this;b5=this.data[this.hash(b2)];return b5&&(b6=v.tryPick(function(b7){var b8;b8=k.KeyValue(b7);return b4.equals.apply(null,[b8[0],b2])?{$:1,$0:b8[1]}:null;},b5),b6!=null&&b6.$==1&&(b3.set(b6.$0),true));},ContainsKey:function(b2){var b3,b4;b3=this;b4=this.data[this.hash(b2)];return b4&&v.exists(function(b5){return b3.equals.apply(null,[(k.KeyValue(b5))[0],b2]);},b4);},GetEnumerator:function(){return bc.Get0(this);},GetEnumerator0:function(){return bc.Get0(v.concat(_5.GetFieldValues(this.data)));}},o,_0);_0.New$5=bZ.Ctor(function(){_0.New$6.call(this,[],l.Equals,l.Hash);},_0);_0.New$6=bZ.Ctor(function(b2,b3,b4){var b5,b6;this.equals=b3;this.hash=b4;this.count=0;this.data=[];b5=bc.Get(b2);try{while(b5.MoveNext()){b6=b5.Current();this.set(b6.K,b6.V);}}finally{if("Dispose"in b5)b5.Dispose();}},_0);_1=Z.HashSet=bZ.Class({Add:function(b2){return this.add(b2);},Contains:function(b2){var b3;b3=this.data[this.hash(b2)];return b3==null?false:this.arrContains(b2,b3);},add:function(b2){var b3,b4;b3=this.hash(b2);b4=this.data[b3];return b4==null?(this.data[b3]=[b2],this.count=this.count+1,true):this.arrContains(b2,b4)?false:(b4.push(b2),this.count=this.count+1,true);},arrContains:function(b2,b3){var b4,b5,b6,b7;b4=true;b5=0;b7=b3.length;while(b4&&b5<b7)if(this.equals.apply(null,[b3[b5],b2]))b4=false;else b5=b5+1;return!b4;},IntersectWith:function(b2){var b3,b4,b5,b6,b7;b3=new _1.New$4(b2,this.equals,this.hash);b4=bD.concat(this.data);for(b5=0,b6=b4.length-1;b5<=b6;b5++){b7=b4[b5];!b3.Contains(b7)?this.Remove(b7):void 0;}},get_Count:function(){return this.count;},CopyTo:function(b2){var b3,b4,b5,b6;b3=0;b4=bD.concat(this.data);for(b5=0,b6=b4.length-1;b5<=b6;b5++)v.set(b2,b5,b4[b5]);},ExceptWith:function(b2){var b3;b3=bc.Get(b2);try{while(b3.MoveNext())this.Remove(b3.Current());}finally{if("Dispose"in b3)b3.Dispose();}},Remove:function(b2){var b3;b3=this.data[this.hash(b2)];return b3==null?false:this.arrRemove(b2,b3)&&(this.count=this.count-1,true);},arrRemove:function(b2,b3){var b4,b5,b6,b7;b4=true;b5=0;b7=b3.length;while(b4&&b5<b7)if(this.equals.apply(null,[b3[b5],b2])){b3.splice.apply(b3,[b5,1]);b4=false;}else b5=b5+1;return!b4;},GetEnumerator:function(){return bc.Get(bD.concat(this.data));},GetEnumerator0:function(){return bc.Get(bD.concat(this.data));}},o,_1);_1.New$3=bZ.Ctor(function(){_1.New$4.call(this,[],l.Equals,l.Hash);},_1);_1.New$4=bZ.Ctor(function(b2,b3,b4){var b5;this.equals=b3;this.hash=b4;this.data=[];this.count=0;b5=bc.Get(b2);try{while(b5.MoveNext())this.add(b5.Current());}finally{if("Dispose"in b5)b5.Dispose();}},_1);_1.New$2=bZ.Ctor(function(b2){_1.New$4.call(this,b2,l.Equals,l.Hash);},_1);_2.Box=a.id;_3.append=function(b2,b3){return{GetEnumerator:function(){var b4,b5;b4=bc.Get(b2);b5=[true];return new bd.New(b4,null,function(b6){var b7;return b6.s.MoveNext()?(b6.c=b6.s.Current(),true):(b7=b6.s,!l.Equals(b7,null)?b7.Dispose():void 0,b6.s=null,b5[0]&&(b5[0]=false,b6.s=bc.Get(b3),b6.s.MoveNext()?(b6.c=b6.s.Current(),true):(b6.s.Dispose(),b6.s=null,false)));},function(b6){var b7;b7=b6.s;!l.Equals(b7,null)?b7.Dispose():void 0;});}};};_3.tryFindIndex=function(b2,b3){var b4,b5,b6;b4=bc.Get(b3);try{b5=true;b6=0;while(b5&&b4.MoveNext())if(b2(b4.Current()))b5=false;else b6=b6+1;return b5?null:{$:1,$0:b6};}finally{if("Dispose"in b4)b4.Dispose();}};_3.iteri=function(b2,b3){var b4,b5;b4=0;b5=bc.Get(b3);try{while(b5.MoveNext()){b2(b4,b5.Current());b4=b4+1;}}finally{if("Dispose"in b5)b5.Dispose();}};_3.indexed=function(b2){return _3.mapi(function(b3,b4){return[b3,b4];},b2);};_3.map=function(b2,b3){return{GetEnumerator:function(){var b4;b4=bc.Get(b3);return new bd.New(null,null,function(b5){return b4.MoveNext()&&(b5.c=b2(b4.Current()),true);},function(){b4.Dispose();});}};};_3.collect=function(b2,b3){return _3.concat(_3.map(b2,b3));};_3.tryPick=function(b2,b3){var b4,b5;b4=bc.Get(b3);try{b5=null;while(l.Equals(b5,null)&&b4.MoveNext())b5=b2(b4.Current());return b5;}finally{if("Dispose"in b4)b4.Dispose();}};_3.mapi=function(b2,b3){return _3.map2(b2,_3.initInfinite(a.id),b3);};_3.concat=function(b2){return{GetEnumerator:function(){var b3;b3=bc.Get(b2);return new bd.New(null,null,function(b4){var b5;while(true){b5=b4.s;if(l.Equals(b5,null)){if(b3.MoveNext()){b4.s=bc.Get(b3.Current());b4=b4;}else{b3.Dispose();return false;}}else if(b5.MoveNext()){b4.c=b5.Current();return true;}else{b4.Dispose();b4.s=null;b4=b4;}}},function(b4){var b5;b5=b4.s;!l.Equals(b5,null)?b5.Dispose():void 0;!l.Equals(b3,null)?b3.Dispose():void 0;});}};};_3.filter=function(b2,b3){return{GetEnumerator:function(){var b4;b4=bc.Get(b3);return new bd.New(null,null,function(b5){var b6,b7,b8;b6=b4.MoveNext();b7=b4.Current();b8=false;while(b6)if(b2(b7)){b5.c=b7;b8=true;b6=false;}else if(b4.MoveNext())b7=b4.Current();else b6=false;return b8;},function(){b4.Dispose();});}};};_3.map2=function(b2,b3,b4){return{GetEnumerator:function(){var b5,b6;b5=bc.Get(b3);b6=bc.Get(b4);return new bd.New(null,null,function(b7){return b5.MoveNext()&&b6.MoveNext()&&(b7.c=b2(b5.Current(),b6.Current()),true);},function(){b5.Dispose();b6.Dispose();});}};};_3.initInfinite=function(b2){return{GetEnumerator:function(){return new bd.New(0,null,function(b3){b3.c=b2(b3.s);b3.s=b3.s+1;return true;},void 0);}};};_3.forall2=function(b2,b3,b4){return!_3.exists2(function(b5,b6){return!b2(b5,b6);},b3,b4);};_3.find=function(b2,b3){var b4;b4=_3.tryFind(b2,b3);return b4==null?k.FailWith("KeyNotFoundException"):b4.$0;};_3.fold=function(b2,b3,b4){var b5,b6;b5=b3;b6=bc.Get(b4);try{while(b6.MoveNext())b5=b2(b5,b6.Current());return b5;}finally{if("Dispose"in b6)b6.Dispose();}};_3.iter=function(b2,b3){var b4;b4=bc.Get(b3);try{while(b4.MoveNext())b2(b4.Current());}finally{if("Dispose"in b4)b4.Dispose();}};_3.exists2=function(b2,b3,b4){var b5,b6,b7,b8;b5=bc.Get(b3);try{b7=bc.Get(b4);try{b8=false;while(!b8&&b5.MoveNext()&&b7.MoveNext())b8=b2(b5.Current(),b7.Current());b6=b8;}finally{if("Dispose"in b7)b7.Dispose();}return b6;}finally{if("Dispose"in b5)b5.Dispose();}};_3.delay=function(b2){return{GetEnumerator:function(){return bc.Get(b2());}};};_3.distinctBy=function(b2,b3){return{GetEnumerator:function(){var b4,b5;b4=bc.Get(b3);b5=new _1.New$3();return new bd.New(null,null,function(b6){var b7,b8;if(b4.MoveNext()){b7=b4.Current();b8=b5.Add(b2(b7));while(!b8&&b4.MoveNext()){b7=b4.Current();b8=b5.Add(b2(b7));}return b8&&(b6.c=b7,true);}else return false;},function(){b4.Dispose();});}};};_3.tryFind=function(b2,b3){var b4,b5,b6;b4=bc.Get(b3);try{b5=null;while(b5==null&&b4.MoveNext()){b6=b4.Current();b2(b6)?b5={$:1,$0:b6}:void 0;}return b5;}finally{if("Dispose"in b4)b4.Dispose();}};_3.distinct=function(b2){return _3.distinctBy(a.id,b2);};_3.forall=function(b2,b3){return!_3.exists(function(b4){return!b2(b4);},b3);};_3.max=function(b2){var b3,b4,b5;b3=bc.Get(b2);try{if(!b3.MoveNext())_3.seqEmpty();b4=b3.Current();while(b3.MoveNext()){b5=b3.Current();l.Compare(b5,b4)===1?b4=b5:void 0;}return b4;}finally{if("Dispose"in b3)b3.Dispose();}};_3.unfold=function(b2,b3){return{GetEnumerator:function(){return new bd.New(b3,null,function(b4){var b5;b5=b2(b4.s);return b5==null?false:(b4.c=b5.$0[0],b4.s=b5.$0[1],true);},void 0);}};};_3.exists=function(b2,b3){var b4,b5;b4=bc.Get(b3);try{b5=false;while(!b5&&b4.MoveNext())b5=b2(b4.Current());return b5;}finally{if("Dispose"in b4)b4.Dispose();}};_3.seqEmpty=function(){return k.FailWith("The input sequence was empty.");};_3.compareWith=function(b2,b3,b4){var b5,b6,b7,b8,b9;b5=bc.Get(b3);try{b7=bc.Get(b4);try{b8=0;b9=true;while(b9&&b8===0)if(b5.MoveNext())b8=b7.MoveNext()?b2(b5.Current(),b7.Current()):1;else if(b7.MoveNext())b8=-1;else b9=false;b6=b8;}finally{if("Dispose"in b7)b7.Dispose();}return b6;}finally{if("Dispose"in b5)b5.Dispose();}};_4.$cctor=function(){_4.$cctor=a.ignore;_4.CubicInOut=be.Custom(function(b2){var b3;b3=b2*b2;return 3*b3-2*(b3*b2);});_4.UseAnimations=true;};_5.GetFieldValues=function(b2){var b3,b4;b3=[];for(var b5 in b2)b3.push(b2[b5]);return b3;};_6.New$1=function(b2,b3){return{Parse:b2,Write:b3};};_7.startsWith=function(b2,b3){var b4;switch(b2.$==1?b3.$==1?l.Equals(b2.$0,b3.$0)?(b4=[b3.$0,b3.$1,b2.$0,b2.$1],1):2:2:0){case 0:return{$:1,$0:b3};break;case 1:return _7.startsWith(b4[3],b4[1]);break;case 2:return null;break;}};_8=e.ConcreteVar=bZ.Class({get_View:function(){return this.view;},Get:function(){return this.current;},Update:function(b2){this.Set(b2(this.Get()));},Set:function(b2){if(this.isConst)(function(b3){return b3("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b3){bW.log(b3);}));else{V.Obsolete(this.snap);this.current=b2;this.snap=V.New({$:2,$0:b2,$1:[]});}},UpdateMaybe:function(b2){var b3;b3=b2(this.Get());b3!=null&&b3.$==1?this.Set(b3.$0):void 0;}},r,_8);_8.New=bZ.Ctor(function(b2,b3,b4){var b5;b5=this;r.New.call(this);this.isConst=b2;this.current=b4;this.snap=b3;this.view=function(){return b5.snap;};this.id=P.Int();},_8);_9.StartsWith=function(b2,b3){return b2.substring(0,b3.length)==b3;};_9.Substring=function(b2,b3,b4){return b2.substr(b3,b4);};_9.SplitChars=function(b2,b3,b4){return _9.Split(b2,new a.RegExp("["+_9.RegexEscape(b3.join(""))+"]"),b4);};_9.concat=function(b2,b3){return v.ofSeq(b3).join(b2);};_9.RegexEscape=function(b2){return b2.replace(new a.RegExp("[-\\/\\\\^$*+?.()|[\\]{}]","g"),"\\$&");};_9.Split=function(b2,b3,b4){return b4===1?v.filter(function(b5){return b5!=="";},_9.SplitWith(b2,b3)):_9.SplitWith(b2,b3);};_9.SplitWith=function(b2,b3){return b2.split(b3);};_9.forall=function(b2,b3){return _3.forall(b2,_9.protect(b3));};_9.IsNullOrEmpty=function(b2){return b2==null||b2=="";};_9.Join=function(b2,b3){return b3.join(b2);};_9.protect=function(b2){return b2===null?"":b2;};_.CreateTextNode=function(){return{Text:X.CreateText(""),Dirty:false,Value:""};};_.UpdateTextNode=function(b2,b3){b2.Value=b3;b2.Dirty=true;};_.LoadedTemplateFile=function(b2){var b3,b4,b5;b3=(b4=null,[_.LoadedTemplates().TryGetValue(b2,{get:function(){return b4;},set:function(b6){b4=b6;}}),b4]);return b3[0]?b3[1]:(b5=new _0.New$5(),(_.LoadedTemplates().set_Item(b2,b5),b5));};_.LoadedTemplates=function(){bv.$cctor();return bv.LoadedTemplates;};_.LinkElement=function(b2,b3){_.InsertDoc(b2,b3,null);};_.CreateRunState=function(b2,b3){return bB.New(bC.get_Empty(),_.CreateElemNode(b2,W.EmptyAttr(),b3));};_.PerformAnimatedUpdate=function(b2,b3){var b4;return f.get_UseAnimations()?(b4=null,bK.Delay(function(){var b5,b6,b7;b5=bC.FindAll(b3);b6=_.ComputeChangeAnim(b2,b5);b7=_.ComputeEnterAnim(b2,b5);return bK.Bind(f.Play(f.Append(b6,_.ComputeExitAnim(b2,b5))),function(){return bK.Bind(_.SyncElemNodesNextFrame(b2),function(){return bK.Bind(f.Play(b7),function(){b2.PreviousNodes=b5;return bK.Return(null);});});});})):_.SyncElemNodesNextFrame(b2);};_.InsertBeforeDelim=function(b2,b3){var b4,b5;b4=b2.parentNode;b5=a.document.createTextNode("");b4.insertBefore(b5,b2);_.LinkPrevElement(b2,b3);return b5;};_.TextHoleRE=function(){bv.$cctor();return bv.TextHoleRE;};_.LocalTemplatesLoaded=function(){bv.$cctor();return bv.LocalTemplatesLoaded;};_.set_LocalTemplatesLoaded=function(b2){bv.$cctor();bv.LocalTemplatesLoaded=b2;};_.InsertDoc=function(b2,b3,b4){var b5;return b3!=null&&b3.$==1?_.InsertNode(b2,b3.$0.El,b4):b3!=null&&b3.$==2?(b5=b3.$0,(b5.Dirty=false,_.InsertDoc(b2,b5.Current,b4))):b3==null?b4:b3!=null&&b3.$==4?_.InsertNode(b2,b3.$0.Text,b4):b3!=null&&b3.$==5?_.InsertNode(b2,b3.$0,b4):b3!=null&&b3.$==6?v.foldBack(function(b6,b7){return b6.constructor===ba?_.InsertDoc(b2,b6,b7):_.InsertNode(b2,b6,b7);},b3.$0.Els,b4):_.InsertDoc(b2,b3.$0,_.InsertDoc(b2,b3.$1,b4));};_.CreateElemNode=function(b2,b3,b4){var b5;_.LinkElement(b2,b4);b5=W.Insert(b2,b3);return bt.New(b5,b4,null,b2,P.Int(),bZ.GetOptional(b5.OnAfterRender));};_.ComputeChangeAnim=function(b2,b3){var b4;function b5(b6){return W.HasChangeAnim(b6.Attr);}b4=function(b6){return bC.Filter(b5,b6);};return f.Concat(v.map(function(b6){return W.GetChangeAnim(b6.Attr);},bC.ToArray(bC.Intersect(b4(b2.PreviousNodes),b4(b3)))));};_.ComputeEnterAnim=function(b2,b3){return f.Concat(v.map(function(b4){return W.GetEnterAnim(b4.Attr);},bC.ToArray(bC.Except(b2.PreviousNodes,bC.Filter(function(b4){return W.HasEnterAnim(b4.Attr);},b3)))));};_.ComputeExitAnim=function(b2,b3){return f.Concat(v.map(function(b4){return W.GetExitAnim(b4.Attr);},bC.ToArray(bC.Except(b3,bC.Filter(function(b4){return W.HasExitAnim(b4.Attr);},b2.PreviousNodes)))));};_.SyncElemNodesNextFrame=function(b2){function b3(b4){a.requestAnimationFrame(function(){_.SyncElemNode(b2.Top);b4();});}return bK.FromContinuations(function(b4,b5,b6){return b3.apply(null,[b4,b5,b6]);});};_.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_.UpdateEmbedNode=function(b2,b3){b2.Current=b3;b2.Dirty=true;};_.LinkPrevElement=function(b2,b3){_.InsertDoc(b2.parentNode,b3,b2);};_.InsertNode=function(b2,b3,b4){X.InsertAt(b2,b4,b3);return b3;};_.SyncElemNode=function(b2){_.SyncElement(b2);_.Sync(b2.Children);_.AfterRender(b2);};_.SyncElement=function(b2){function b3(b4){function b5(b6){var b7,b8;return b6!=null&&b6.$==0?b5(b6.$0)||b5(b6.$1):b6!=null&&b6.$==2?(b7=b6.$0,b7.Dirty||b5(b7.Current)):b6!=null&&b6.$==6&&(b8=b6.$0,b8.Dirty||v.exists(b3,b8.Holes));}return b5(b4.Children);}W.Sync(b2.El,b2.Attr);b3(b2)?_.DoSyncElement(b2):void 0;};_.Sync=function(b2){var b3,b4;if(b2!=null&&b2.$==1)_.SyncElemNode(b2.$0);else if(b2!=null&&b2.$==2)_.Sync(b2.$0.Current);else if(b2==null);else if(b2!=null&&b2.$==5);else if(b2!=null&&b2.$==4){b3=b2.$0;b3.Dirty?(b3.Text.nodeValue=b3.Value,b3.Dirty=false):void 0;}else if(b2!=null&&b2.$==6){b4=b2.$0;v.iter(function(b5){_.SyncElemNode(b5);},b4.Holes);v.iter(function(b5){W.Sync(b5[0],b5[1]);},b4.Attrs);_.AfterRender(b4);}else{_.Sync(b2.$0);_.Sync(b2.$1);}};_.AfterRender=function(b2){var b3;b3=bZ.GetOptional(b2.Render);b3!=null&&b3.$==1?(b3.$0(b2.El),bZ.SetOptional(b2,"Render",null)):void 0;};_.DoSyncElement=function(b2){var b3,b4,b5;function b6(b7,b8){var b9,b_;return b7!=null&&b7.$==1?b7.$0.El:b7!=null&&b7.$==2?(b9=b7.$0,b9.Dirty?(b9.Dirty=false,_.InsertDoc(b3,b9.Current,b8)):b6(b9.Current,b8)):b7==null?b8:b7!=null&&b7.$==4?b7.$0.Text:b7!=null&&b7.$==5?b7.$0:b7!=null&&b7.$==6?(b_=b7.$0,(b_.Dirty?b_.Dirty=false:void 0,v.foldBack(function(b$,ca){return b$.constructor===ba?b6(b$,ca):b$;},b_.Els,b8))):b6(b7.$0,b6(b7.$1,b8));}b3=b2.El;bV.Iter((b4=b2.El,function(b7){X.RemoveNode(b4,b7);}),bV.Except(bV.DocChildren(b2),bV.Children(b2.El,bZ.GetOptional(b2.Delimiters))));b6(b2.Children,(b5=bZ.GetOptional(b2.Delimiters),b5!=null&&b5.$==1?b5.$0[1]:null));};V.Obsolete=function(b2){var b3,b4,b5,b6,b7;b4=b2.s;if(b4==null||(b4!=null&&b4.$==2?(b3=b4.$1,false):b4!=null&&b4.$==3?(b3=b4.$1,false):true))void 0;else{b2.s=null;for(b5=0,b6=v.length(b3)-1;b5<=b6;b5++){b7=v.get(b3,b5);typeof b7=="object"?function(b8){V.Obsolete(b8);}(b7):b7();}}};V.New=function(b2){return{s:b2};};$=e.DynamicAttrNode=bZ.Class({NChanged:function(){return this.updates;},NGetChangeAnim:function(b2){return f.get_Empty();},NGetEnterAnim:function(b2){return f.get_Empty();},NGetExitAnim:function(b2){return f.get_Empty();},NSync:function(b2){if(this.dirty){(this.push(b2))(this.value);this.dirty=false;}}},o,$);$.New=bZ.Ctor(function(b2,b3){var b4;b4=this;this.push=b3;this.value=void 0;this.dirty=false;this.updates=u.Map(function(b5){b4.value=b5;b4.dirty=true;},b2);},$);bb.notPresent=function(){return k.FailWith("The given key was not present in the dictionary.");};bc.Get=function(b2){return b2 instanceof a.Array?bc.ArrayEnumerator(b2):l.Equals(typeof b2,"string")?bc.StringEnumerator(b2):b2.GetEnumerator();};bc.ArrayEnumerator=function(b2){return new bd.New(0,null,function(b3){var b4;b4=b3.s;return b4<v.length(b2)&&(b3.c=v.get(b2,b4),b3.s=b4+1,true);},void 0);};bc.StringEnumerator=function(b2){return new bd.New(0,null,function(b3){var b4;b4=b3.s;return b4<b2.length&&(b3.c=b2[b4],b3.s=b4+1,true);},void 0);};bc.Get0=function(b2){return b2 instanceof a.Array?bc.ArrayEnumerator(b2):l.Equals(typeof b2,"string")?bc.StringEnumerator(b2):"GetEnumerator0"in b2?b2.GetEnumerator0():b2.GetEnumerator();};bd=bc.T=bZ.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},o,bd);bd.New=bZ.Ctor(function(b2,b3,b4,b5){this.s=b2;this.c=b3;this.n=b4;this.d=b5;},bd);be=e.Easing=bZ.Class({},o,be);be.Custom=function(b2){return new be.New(b2);};be.New=bZ.Ctor(function(b2){this.transformTime=b2;},be);bf=Z.FSharpMap=bZ.Class({Equals:function(b2){return this.get_Count()===b2.get_Count()&&_3.forall2(l.Equals,this,b2);},GetEnumerator$1:function(){return bc.Get(_3.map(function(b2){return{K:b2.Key,V:b2.Value};},bm.Enumerate(false,this.tree)));},get_Count:function(){var b2;b2=this.tree;return b2==null?0:b2.Count;},GetHashCode:function(){return l.Hash(v.ofSeq(this));},Add:function(b2,b3){return new bf.New$1(bm.Add(bo.New(b2,b3),this.tree));},get_IsEmpty:function(){return this.tree==null;},get_Tree:function(){return this.tree;},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(b2){return _3.compareWith(l.Compare,this,b2);}},o,bf);bf.New=bZ.Ctor(function(b2){bf.New$1.call(this,bE.fromSeq(b2));},bf);bf.New$1=bZ.Ctor(function(b2){this.tree=b2;},bf);bg.OfArray=function(b2){return new bf.New$1(bm.OfSeq(_3.map(function(b3){return bo.New(b3[0],b3[1]);},b2)));};bg.FoldBack=function(b2,b3,b4){return _3.fold(function(b5,b6){return b2(b6.Key,b6.Value,b5);},b4,bm.Enumerate(true,b3.get_Tree()));};bg.ToSeq=function(b2){return _3.map(function(b3){return[b3.Key,b3.Value];},bm.Enumerate(false,b2.get_Tree()));};bh.CreateFromValue=function(b2){return bq.New(true,b2,bh.cachedLazy);};bh.cachedLazy=function(){return this.v;};bh.Create=function(b2){return bq.New(false,b2,bh.forceLazy);};bh.forceLazy=function(){var b2;b2=this.v();this.c=true;this.v=b2;this.f=bh.cachedLazy;return b2;};bi.$cctor=function(){bi.$cctor=a.ignore;bi.counter=0;};u=e.View=bZ.Class({},null,u);bj.$cctor=function(){bj.$cctor=a.ignore;bj.EmptyAttr=null;};bk.$cctor=function(){bk.$cctor=a.ignore;bk.Doc=a.document;};bl.StartProcessor=function(b2){var b3;function b4(){var b5;b5=null;return bK.Delay(function(){return bK.Bind(b2,function(){var b6;b6=b3[0];return b6===1?(b3[0]=0,bK.Zero()):b6===2?(b3[0]=1,b4()):bK.Zero();});});}b3=[0];return function(){var b5;b5=b3[0];b5===0?(b3[0]=1,bK.Start(b4(),null)):b5===1?b3[0]=2:void 0;};};bn.New=function(b2,b3,b4,b5,b6){return{Node:b2,Left:b3,Right:b4,Height:b5,Count:b6};};bo=Z.Pair=bZ.Class({Equals:function(b2){return l.Equals(this.Key,b2.Key);},GetHashCode:function(){return l.Hash(this.Key);},CompareTo0:function(b2){return l.Compare(this.Key,b2.Key);}},null,bo);bo.New=function(b2,b3){return new bo({Key:b2,Value:b3});};bq.New=function(b2,b3,b4){return{c:b2,v:b3,f:b4};};br.WriteLink=function(b2,b3){var b4;b4=b3.get_IsEmpty()?"":"?"+br.WriteQuery(b3);return"/"+br.Concat(b2)+b4;};br.WriteQuery=function(b2){function b3(b4,b5){return b4+"="+b5;}return _9.concat("&",_3.map(function(b4){return b3(b4[0],b4[1]);},bg.ToSeq(b2)));};br.Concat=function(b2){var b3,b4;b3=[];b4=true;p.iter(function(b5){if(!_9.IsNullOrEmpty(b5)){b4?b4=false:b3.push("/");b3.push(b5);}},b2);return _9.Join("",v.ofSeq(b3));};bs.replaceFirst=function(b2,b3,b4){var b5;b5=[false];return p.map(function(b6){return!b5[0]&&b2(b6)?b3(b6):b6;},b4);};bs.maybeReplaceFirst=function(b2,b3,b4){var b5;b5=[false];return p.map(function(b6){var b7;return!b5[0]&&b2(b6)?(b7=b3(b6),b7==null?b6:b7.$0):b6;},b4);};bt=e.DocElemNode=bZ.Class({Equals:function(b2){return this.ElKey===b2.ElKey;},GetHashCode:function(){return this.ElKey;}},null,bt);bt.New=function(b2,b3,b4,b5,b6,b7){var b8;return new bt((b8={Attr:b2,Children:b3,El:b5,ElKey:b6},(bZ.SetOptional(b8,"Delimiters",b4),bZ.SetOptional(b8,"Render",b7),b8)));};bv.$cctor=function(){bv.$cctor=a.ignore;bv.LoadedTemplates=new _0.New$5();bv.LocalTemplatesLoaded=false;bv.TextHoleRE="\\${([^}]+)}";};bw=e.CheckedInput=bZ.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,bw);bx.string=function(b2,b3,b4){return b3==null?b4!=null&&b4.$==1?b2.slice(0,b4.$0+1):"":b4==null?b2.slice(b3.$0):b2.slice(b3.$0,b4.$0+1);};by=e.Elt=bZ.Class({},S,by);by.TreeNode=function(b2,b3){var b4,b5;function b6(b7){return b7[1];}b4=bJ.Create(b3);return new by.New$1({$:6,$0:b2},u.Map2Unit((b5=v.map(function(b7){return W.Updates(b6(b7));},b2.Attrs),Y.TreeReduce(u.Const(),u.Map2Unit,b5)),b4.v),v.get(b2.Els,0),b4);};by.New$1=bZ.Ctor(function(b2,b3,b4,b5){S.New.call(this,b2,b3);this.docNode$1=b2;this.updates$1=b3;this.elt=b4;this.rvUpdates=b5;},by);bB.New=function(b2,b3){return{PreviousNodes:b2,Top:b3};};bC.get_Empty=function(){return{$:0,$0:new _1.New$3()};};bC.FindAll=function(b2){var b3;function b4(b6){if(b6!=null&&b6.$==0){b4(b6.$0);b4(b6.$1);}else if(b6!=null&&b6.$==1)b5(b6.$0);else if(b6!=null&&b6.$==2)b4(b6.$0.Current);else if(b6!=null&&b6.$==6)v.iter(b5,b6.$0.Holes);}function b5(b6){b3.push(b6);b4(b6.Children);}b3=[];b4(b2);return{$:0,$0:new _1.New$2(b3)};};bC.Filter=function(b2,b3){return{$:0,$0:bQ.Filter(b2,b3.$0)};};bC.Intersect=function(b2,b3){return{$:0,$0:bQ.Intersect(b2.$0,b3.$0)};};bC.ToArray=function(b2){return bQ.ToArray(b2.$0);};bC.Except=function(b2,b3){return{$:0,$0:bQ.Except(b2.$0,b3.$0)};};bD.concat=function(b2){var b3,b4;b3=[];for(var b5 in b2)b3.push.apply(b3,b2[b5]);return b3;};bE.fromSeq=function(b2){var b3;b3=v.ofSeq(_3.delay(function(){return _3.collect(function(b4){return[bo.New(b4[0],b4[1])];},_3.distinctBy(function(b4){return b4[0];},b2));}));v.sortInPlace(b3);return bm.Build(b3,0,b3.length-1);};bG.New=function(b2,b3,b4,b5){var b6;b6={DynElem:b2,DynFlags:b3,DynNodes:b4};bZ.SetOptional(b6,"OnAfterRender",b5);return b6;};bH.Clear=function(b2){b2.splice(0,v.length(b2));};bI.isBlank=function(b2){return _9.forall(bM.IsWhiteSpace,b2);};bJ=e.Updates=bZ.Class({},null,bJ);bJ.Create=function(b2){var b3;b3=null;b3=bJ.New(b2,null,function(){var b4;b4=b3.s;return b4===null?(b4=V.Copy(b3.c()),b3.s=b4,V.WhenObsoleteRun(b4,function(){b3.s=null;}),b4):b4;});return b3;};bJ.New=function(b2,b3,b4){return new bJ({c:b2,s:b3,v:b4});};bK.Delay=function(b2){return function(b3){try{(b2(null))(b3);}catch(b4){b3.k({$:1,$0:b4});}};};bK.Bind=function(b2,b3){return bK.checkCancel(function(b4){b2(bN.New(function(b5){var b6;if(b5.$==0){b6=b5.$0;bK.scheduler().Fork(function(){try{(b3(b6))(b4);}catch(b7){b4.k({$:1,$0:b7});}});}else bK.scheduler().Fork(function(){b4.k(b5);});},b4.ct));});};bK.Zero=function(){bO.$cctor();return bO.Zero;};bK.Start=function(b2,b3){var b4,b5;b4=(b5=(bK.defCTS())[0],b3==null?b5:b3.$0);bK.scheduler().Fork(function(){if(!b4.c)b2(bN.New(function(b6){if(b6.$==1)bK.UncaughtAsyncError(b6.$0);},b4));});};bK.Return=function(b2){return function(b3){b3.k({$:0,$0:b2});};};bK.checkCancel=function(b2){return function(b3){if(b3.ct.c)bK.cancel(b3);else b2(b3);};};bK.defCTS=function(){bO.$cctor();return bO.defCTS;};bK.UncaughtAsyncError=function(b2){bW.log("WebSharper: Uncaught asynchronous exception",b2);};bK.FromContinuations=function(b2){return function(b3){var b4;function b5(b6){if(b4[0])k.FailWith("A continuation provided by Async.FromContinuations was invoked multiple times");else{b4[0]=true;bK.scheduler().Fork(b6);}}b4=[false];b2(function(b6){b5(function(){b3.k({$:0,$0:b6});});},function(b6){b5(function(){b3.k({$:1,$0:b6});});},function(b6){b5(function(){b3.k({$:2,$0:b6});});});};};bK.cancel=function(b2){b2.k({$:2,$0:new bT.New(b2.ct)});};bK.scheduler=function(){bO.$cctor();return bO.scheduler;};bL.Append=function(b2,b3){return b2.$==0?b3:b3.$==0?b2:{$:2,$0:b2,$1:b3};};bL.Concat=function(b2){var b3;b3=Y.ofSeqNonCopying(b2);return Y.TreeReduce(bL.Empty(),bL.Append,b3);};bL.ToArray=function(b2){var b3;function b4(b5){if(b5.$==1)b3.push(b5.$0);else if(b5.$==2){b4(b5.$0);b4(b5.$1);}else if(b5.$==3)v.iter(function(b6){b3.push(b6);},b5.$0);}b3=[];b4(b2);return b3.slice(0);};bL.Empty=function(){bU.$cctor();return bU.Empty;};bm.OfSeq=function(b2){var b3;b3=v.ofSeq(_3.distinct(b2));v.sortInPlace(b3);return bm.Build(b3,0,b3.length-1);};bm.Enumerate=function(b2,b3){function b4(b5,b6){var b7;while(true)if(b5==null)return b6.$==1?{$:1,$0:[b6.$0[0],[b6.$0[1],b6.$1]]}:null;else if(b2){b7=b5;b5=b7.Right;b6=new q({$:1,$0:[b7.Node,b7.Left],$1:b6});}else{b7=b5;b5=b7.Left;b6=new q({$:1,$0:[b7.Node,b7.Right],$1:b6});}}return _3.unfold(function(b5){return b4(b5[0],b5[1]);},[b3,q.Empty]);};bm.Build=function(b2,b3,b4){var b5,b6,b7;return b4-b3+1<=0?null:(b5=(b3+b4)/2>>0,(b6=bm.Build(b2,b3,b5-1),(b7=bm.Build(b2,b5+1,b4),bm.Branch(v.get(b2,b5),b6,b7))));};bm.Add=function(b2,b3){return bm.Put(function(b4,b5){return b5;},b2,b3);};bm.Branch=function(b2,b3,b4){var b5,b6;return bn.New(b2,b3,b4,1+(b5=b3==null?0:b3.Height,(b6=b4==null?0:b4.Height,l.Compare(b5,b6)===1?b5:b6)),1+(b3==null?0:b3.Count)+(b4==null?0:b4.Count));};bm.Put=function(b2,b3,b4){var b5,b6;b5=bm.Lookup(b3,b4);b6=b5[0];return b6==null?bm.Rebuild(b5[1],bm.Branch(b3,null,null)):bm.Rebuild(b5[1],bm.Branch(b2(b6.Node,b3),b6.Left,b6.Right));};bm.Lookup=function(b2,b3){var b4,b5,b6,b7;b4=[];b5=b3;b6=true;while(b6)if(b5==null)b6=false;else{b7=l.Compare(b2,b5.Node);b7===0?b6=false:b7===1?(b4.unshift([true,b5.Node,b5.Left]),b5=b5.Right):(b4.unshift([false,b5.Node,b5.Right]),b5=b5.Left);}return[b5,b4];};bm.Rebuild=function(b2,b3){var b4,b6,b7,b8,b9,b_,b$,ca,cb,cc;function b5(cd){return cd==null?0:cd.Height;}b4=b3;for(b6=0,b7=v.length(b2)-1;b6<=b7;b6++){b4=(b8=v.get(b2,b6),b8[0]?(b9=b8[1],(b_=b8[2],b5(b4)>b5(b_)+1?b5(b4.Left)===b5(b4.Right)+1?(b$=b4.Left,bm.Branch(b$.Node,bm.Branch(b9,b_,b$.Left),bm.Branch(b4.Node,b$.Right,b4.Right))):bm.Branch(b4.Node,bm.Branch(b9,b_,b4.Left),b4.Right):bm.Branch(b9,b_,b4))):(ca=b8[1],(cb=b8[2],b5(b4)>b5(cb)+1?b5(b4.Right)===b5(b4.Left)+1?(cc=b4.Right,bm.Branch(cc.Node,bm.Branch(b4.Node,b4.Left,cc.Left),bm.Branch(ca,cc.Right,cb))):bm.Branch(b4.Node,b4.Left,bm.Branch(ca,b4.Right,cb)):bm.Branch(ca,b4,cb))));}return b4;};bM.IsWhiteSpace=function(b2){return b2.match(new a.RegExp("\\s"))!==null;};R.TryParse=function(b2,b3,b4,b5){var b6,b7;b6=+b2;b7=b6===b6-b6%1&&b6>=b3&&b6<=b4;b7?b5.set(b6):void 0;return b7;};bN.New=function(b2,b3){return{k:b2,ct:b3};};bO.$cctor=function(){bO.$cctor=a.ignore;bO.noneCT=bP.New(false,[]);bO.scheduler=new bR.New();bO.defCTS=[new bS.New()];bO.Zero=bK.Return();bO.GetCT=function(b2){b2.k({$:0,$0:b2.ct});};};bP.New=function(b2,b3){return{c:b2,r:b3};};bQ.Filter=function(b2,b3){return new _1.New$2(v.filter(b2,bQ.ToArray(b3)));};bQ.Intersect=function(b2,b3){var b4;b4=new _1.New$2(bQ.ToArray(b2));b4.IntersectWith(bQ.ToArray(b3));return b4;};bQ.ToArray=function(b2){var b3;b3=v.create(b2.get_Count(),void 0);b2.CopyTo(b3);return b3;};bQ.Except=function(b2,b3){var b4;b4=new _1.New$2(bQ.ToArray(b3));b4.ExceptWith(bQ.ToArray(b2));return b4;};v.mapiInPlace=function(b2,b3){var b4,b5;for(b4=0,b5=b3.length-1;b4<=b5;b4++)b3[b4]=b2(b4,b3[b4]);return b3;};v.mapInPlace=function(b2,b3){var b4,b5;for(b4=0,b5=b3.length-1;b4<=b5;b4++)b3[b4]=b2(b3[b4]);};bR=bK.Scheduler=bZ.Class({Fork:function(b2){var b3;b3=this;this.robin.push(b2);this.idle?(this.idle=false,a.setTimeout(function(){b3.tick();},0)):void 0;},tick:function(){var b2,b3,b4;b3=this;b4=b1.now();b2=true;while(b2)if(this.robin.length===0){this.idle=true;b2=false;}else{(this.robin.shift())();b1.now()-b4>40?(a.setTimeout(function(){b3.tick();},0),b2=false):void 0;}}},o,bR);bR.New=bZ.Ctor(function(){this.idle=true;this.robin=[];},bR);bS=d.CancellationTokenSource=bZ.Class({},o,bS);bS.New=bZ.Ctor(function(){this.c=false;this.pending=null;this.r=[];this.init=1;},bS);bT=d.OperationCanceledException=bZ.Class({},null,bT);bT.New=bZ.Ctor(function(b2){bT.New$1.call(this,"The operation was canceled.",null,b2);},bT);bT.New$1=bZ.Ctor(function(b2,b3,b4){this.message=b2;this.inner=b3;this.ct=b4;},bT);bU.$cctor=function(){bU.$cctor=a.ignore;bU.Empty={$:0};};bV.DocChildren=function(b2){var b3;function b4(b5){if(b5!=null&&b5.$==2)b4(b5.$0.Current);else if(b5!=null&&b5.$==1)b3.push(b5.$0.El);else if(b5==null);else if(b5!=null&&b5.$==5)b3.push(b5.$0);else if(b5!=null&&b5.$==4)b3.push(b5.$0.Text);else if(b5!=null&&b5.$==6)v.iter(function(b6){if(b6.constructor===ba)b4(b6);else b3.push(b6);},b5.$0.Els);else{b4(b5.$0);b4(b5.$1);}}b3=[];b4(b2.Children);return{$:0,$0:Y.ofSeqNonCopying(b3)};};bV.Children=function(b2,b3){var b4,b5,b6;if(b3!=null&&b3.$==1){b6=[];b4=b3.$0[0].nextSibling;while(b4!==b3.$0[1]){b6.push(b4);b4=b4.nextSibling;}return{$:0,$0:b6};}else return{$:0,$0:v.init(b2.childNodes.length,(b5=b2.childNodes,function(b7){return b5[b7];}))};};bV.Except=function(b2,b3){var b4;b4=b2.$0;return{$:0,$0:v.filter(function(b5){return v.forall(function(b6){return!(b5===b6);},b4);},b3.$0)};};bV.Iter=function(b2,b3){v.iter(b2,b3.$0);};bZ.OnLoad(function(){c.Main();});}());


if (typeof IntelliFactory !=='undefined')
  IntelliFactory.Runtime.Start();
